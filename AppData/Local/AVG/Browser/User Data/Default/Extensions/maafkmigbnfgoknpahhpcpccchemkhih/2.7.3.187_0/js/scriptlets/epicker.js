"use strict";(async()=>{const e=vAPI.randomToken();let t,n,o=document.querySelector(`[${vAPI.sessionId}]`);if(null!==o)return;const i=/^#[$?]?#/,r=[],s=[];let l=[],c=[],a=null;const u=window.location.host+window.location.pathname;let f="",d="";const h=function(e,t){if(null!==e)try{return e.querySelectorAll(t)}catch(e){}return[]},m=function(e){let t="function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{height:0,left:0,top:0,width:0};if(0!==t.width&&0!==t.height)return t;let n=t.left,o=t.right,i=t.top,r=t.bottom;for(const s of e.children)t=m(s),0!==t.width&&0!==t.height&&(t.left<n&&(n=t.left),t.right>o&&(o=t.right),t.top<i&&(i=t.top),t.bottom>r&&(r=t.bottom));return{height:r-i,left:n,top:i,width:o-n}},p=function(e,n){if(!0!==n&&e.length===l.length&&(0===e.length||e[0]===l[0]))return;l=[];const i=self.innerWidth,r=self.innerHeight,s=[];for(const t of e){if(t===o)continue;l.push(t);const e=m(t);e.left>i||e.top>r||e.left+e.width<0||e.top+e.height<0||s.push(`M${e.left} ${e.top}h${e.width}v${e.height}h-${e.width}z`)}vAPI.MessagingConnection.sendTo(t,{what:"svgPaths",ocean:`M0 0h${i}v${r}h-${i}z`,islands:s.join("")})},g=function(e){if(0===e.length)return"";if(1===e.length||self.diff_match_patch instanceof Function==0)return e[0];const t=new self.diff_match_patch;let n=e[0];for(let o=1;o<e.length;o++){const i=t.diff_main(e[o].split("").join("\n"),n.split("").join("\n")),r=[];for(const e of i)0!==e[0]?r.push("*"):r.push(e[1].replace(/\n+/g,"")),n=r.join("")}return n=n.replace(/^\*+$/,"").replace(/\*{2,}/g,"*").replace(/([^*]{1,3}\*)(?:[^*]{1,3}\*)+/g,"$1"),n},v=function(e){const t=e.indexOf("#");return-1!==t?e.slice(0,t):e},y=function(e){const t=window.getComputedStyle(e).backgroundImage||"",n=/^url\((["']?)([^"']+)\1\)$/.exec(t),o=null!==n&&3===n.length?n[2]:"";return-1===o.lastIndexOf("data:",0)?v(o.slice(0,1024)):""},b=function(e){if(null===e)return 0;if(1!==e.nodeType)return 0;const t=function(e){const t=[],n=e.localName,o=A[n];if(void 0===o){const n=y(e);return""!==n&&t.push(n),t}{const n=e[o];"string"==typeof n&&/^https?:\/\//.test(n)&&t.push(v(n.slice(0,1024)))}return function(e,t){let n=e.srcset;if("string"==typeof n&&""!==n)for(;n=n.trim(),0!==n.length&&!/^,/.test(n);){let e=/^\S+/.exec(n);if(null===e)break;n=n.slice(e.index+e[0].length);let o=e[0];if(/,$/.test(o)){if(o=o.replace(/,$/,""),/,$/.test(o))break}else{if(e=/^[^,]*(?:\(.+?\))?[^,]*(?:,|$)/.exec(n),null===e)break;n=n.slice(e.index+e[0].length)}const i=new URL(o,document.baseURI);0!==i.pathname.length&&t.push(v(i.href))}}(e,t),t}(e);if(0===t.length)return 0;-1===c.indexOf(e)&&c.push(e);const n=r,o=n.length;for(let e=0;e<t.length;e++)t[e]=t[e].replace(/^https?:\/\//,"");const i=g(t);null===a&&(a={type:"net",filters:n,slot:n.length}),n.push(`||${i}`);const s=i.indexOf("?");return-1!==s&&n.push(`||${i.slice(0,s)}`),function(e,t){const n=self.location.hostname;if(""===d||""===n||n!==f)return f=n,d=e,void vAPI.messaging.send("elementPicker",{what:"elementPickerEprom",lastNetFilterSession:u,lastNetFilterHostname:f,lastNetFilterUnion:d});f=n;let o=g([e,d]);if("/*"!==o&&o!==e){const e=`||${o}`;-1===t.indexOf(e)&&t.push(e),d=o}vAPI.messaging.send("elementPicker",{what:"elementPickerEprom",lastNetFilterSession:u,lastNetFilterHostname:f,lastNetFilterUnion:d})}(i,n),n.length-o},A={audio:"src",embed:"src",iframe:"src",img:"src",object:"data",video:"src"},P={audio:"media",embed:"object",iframe:"subdocument",img:"image",object:"object",video:"media"},w=function(e){if(null===e)return 0;if(1!==e.nodeType)return 0;-1===c.indexOf(e)&&c.push(e);let t="",n="string"==typeof e.id&&CSS.escape(e.id);if(n&&(t="#"+n),n=e.classList,n){let e=n.length||0;for(;e--;)t+="."+CSS.escape(n.item(e))}const o=e.localName;if(""===t){let i,r=[];switch(o){case"a":n=e.getAttribute("href"),n&&(n=n.trim().replace(/\?.*$/,""),n.length&&r.push({k:"href",v:n}));break;case"iframe":case"img":if(n=e.getAttribute("src"),n&&0!==n.length){if(n=n.trim(),n.startsWith("data:")){let e=n.indexOf(",");-1!==e&&(n=n.slice(0,e+1))}else n.startsWith("blob:")&&(n=new URL(n.slice(5)),n.pathname="",n="blob:"+n.href);r.push({k:"src",v:n.slice(0,256)});break}if(n=e.getAttribute("alt"),n&&0!==n.length){r.push({k:"alt",v:n});break}}for(;i=r.pop();)0!==i.v.length&&(n=e.getAttribute(i.k),i.v===n?t+=`[${i.k}="${i.v}"]`:n.startsWith(i.v)?t+=`[${i.k}^="${i.v}"]`:t+=`[${i.k}*="${i.v}"]`)}const i=e.parentNode;if((""===t||h(i,`:scope > ${t}`).length>1)&&(t=o+t),h(i,`:scope > ${t}`).length>1){let n=1;for(;null!==e.previousSibling;)"string"==typeof(e=e.previousSibling).localName&&e.localName===o&&n++;t+=`:nth-of-type(${n})`}return null===a&&(a={type:"cosmetic",filters:s,slot:s.length}),s.push(`##${t}`),1},k=function(e,t){a=null,r.length=0,s.length=0,c.length=0;let n=null;"number"==typeof e?n=S(e,t):e instanceof HTMLElement&&(n=e,e=void 0),null!==n&&b(n);let o=n;for(;o&&o!==document.body;)w(o),o=o.parentNode;let i=s.length;if(0!==i){const e=s[i-1].slice(2);h(document.body,e).length>1&&s.push("##body")}if("number"==typeof e){const i=vAPI.sessionId+"-clickblind";for(o=n;null!==o;){const n=o;if(o.setAttribute(i,""),o=S(e,t),null===o||o===n)break;b(o)}for(const e of document.querySelectorAll(`[${i}]`))e.removeAttribute(i);b(document.body)}return r.length+s.length},I=(()=>{const e="^[\\w-]+://(?:[^/?#]+\\.)?",t="(?:[^%.0-9a-z_-]|$)",n=/:(?::?after|:?before|:[a-z-]+)$/;let r,s;vAPI.epickerStyleProxies=vAPI.epickerStyleProxies||new Map;let l=!1;const a=function(){if(u(),!1===Array.isArray(s))return;const e=document.documentElement;for(const{elem:t,style:n}of s){if(t===o)continue;if(t===e&&n===vAPI.hideStyle)continue;let i=vAPI.epickerStyleProxies.get(n);void 0===i&&(i=vAPI.randomToken(),vAPI.epickerStyleProxies.set(n,i),vAPI.userStylesheet.add(`[${i}]\n{${n}}`,!0)),t.setAttribute(i,"")}},u=function(){for(const e of vAPI.epickerStyleProxies.values())for(const t of document.querySelectorAll(`[${e}]`))t.removeAttribute(e)};return{preview:function(e,t=!1){if(l=!1!==e,!1===l)return u();if(!1===Array.isArray(s))return;if(!1===t||!1===i.test(r))return a();if(vAPI.domFilterer instanceof Object==0)return;const n=new Set,o=new Set;for(const{raw:e}of s)e.startsWith("{")?o.add(e):n.add(e);0!==n.size&&vAPI.domFilterer.addCSSRule(Array.from(n),vAPI.hideStyle,{mustInject:!0}),0!==o.size&&vAPI.domFilterer.addProceduralSelectors(Array.from(o))},queryAll:function(f){let{filter:d,compiled:h}=f;return d=d.trim(),d===r?s:(u(),""===d||"!"===d?(r="",void(s=void 0)):(r=d,!1===i.test(d)?(s=function(n){const o=[];if(/^[0-9a-z]$/i.test(n))return o;let i="";if(n.length>2&&n.startsWith("/")&&n.endsWith("/"))i=n.slice(1,-1);else if(/^\w[\w.-]*[a-z]$/i.test(n))i=e+n.toLowerCase().replace(/\./g,"\\.")+t;else{let o="",r="";n.startsWith("||")?(o=e,n=n.slice(2)):n.startsWith("|")&&(o="^",n=n.slice(1)),n.endsWith("|")&&(r="$",n=n.slice(0,-1)),i=o+n.replace(/[.+?${}()|[\]\\]/g,"\\$&").replace(/\*+/g,".*").replace(/\^/g,t)+r}let r=null;try{r=new RegExp(i,"i")}catch(e){return o}const s=document.querySelectorAll(Object.keys(A).join());for(const e of s){const t=A[e.localName],n=e[t];("string"==typeof n&&r.test(n)||"string"==typeof e.currentSrc&&r.test(e.currentSrc))&&o.push({elem:e,src:t,opt:P[e.localName],style:vAPI.hideStyle})}for(const e of c)r.test(y(e))&&o.push({elem:e,bg:!0,opt:"image",style:"background-image:none!important;"});return o}(d),l&&a(),s):(s=function(e){let t;try{document.documentElement.matches(`${e},\na`),t=document.querySelectorAll(e.replace(n,""))}catch(e){return}const i=[];for(const n of t)n!==o&&i.push({elem:n,raw:e,style:vAPI.hideStyle});return i}(h),s?(l&&a(),s):(s=function(e){if("string"!=typeof e)return;let t,n;try{const o=JSON.parse(e);t=vAPI.domFilterer.createProceduralFilter(o).exec(),n=void 0===o.action||":style"!==o.action[0]?vAPI.hideStyle:o.action[1]}catch(e){return}if(!t)return;const o=[];for(const i of t)o.push({elem:i,raw:e,style:n});return o}(h),l&&a(),s))))}}})(),$=function(e){vAPI.MessagingConnection.sendTo(t,{what:"showDialog",url:self.location.href,netFilters:r,cosmeticFilters:s,filter:a,options:e})},S=(()=>{let e,t;return(n,i)=>{if(void 0!==n)e=n,t=i;else{if(void 0===e)return null;n=e,i=t}if(!o)return null;const r=`${vAPI.sessionId}-clickblind`;o.setAttribute(r,"");let s=document.elementFromPoint(n,i);return s!==document.body&&s!==document.documentElement||(s=null),o.removeAttribute(r),s}})(),x=function(e,t){const n=S(e,t);p(n?[n]:[])},E=function(e,t,n){if(n.highlight){const n=S(e,t);return void(n&&p([n]))}let o=0!==l.length&&l[0]||null;if(null===o&&void 0!==e&&(o=S(e,t)),o instanceof Element==0)return;const i=function(e,t){const n=window.getComputedStyle(e);return n?n[t]:""};let r=!1,s=o;do{r=parseInt(i(s,"zIndex"),10)>=1e3||"fixed"===i(s,"position"),s=s.parentElement}while(null!==s&&!1===r);if(r){const e=document;"hidden"===i(e.body,"overflowY")&&e.body.style.setProperty("overflow","auto","important"),"fixed"===i(e.body,"position")&&e.body.style.setProperty("position","initial","important"),"fixed"===i(e.documentElement,"position")&&e.documentElement.style.setProperty("position","initial","important"),"hidden"===i(e.documentElement,"overflowY")&&e.documentElement.style.setProperty("overflow","auto","important")}o.remove(),x(e,t)},C=function(e){return"Delete"!==e.key&&"Backspace"!==e.key||!n.zap?"Escape"===e.key||27===e.which?(e.stopPropagation(),e.preventDefault(),I.preview(!1),void N()):void 0:(e.stopPropagation(),e.preventDefault(),void E())},F=function(){p(l,!0)},N=function(){self.removeEventListener("scroll",F,{passive:!0}),self.removeEventListener("resize",F,{passive:!0}),self.removeEventListener("keydown",C,!0),vAPI.shutdown.remove(N),vAPI.MessagingConnection.disconnectFrom(t),vAPI.MessagingConnection.removeListener(z),vAPI.userStylesheet.remove(L),vAPI.userStylesheet.apply(),null!==o&&(o.remove(),o=null,self.focus())},z=function(i){if(i.from===`epickerDialog-${e}`)switch(i.what){case"connectionRequested":return t=i.id,!0;case"connectionBroken":N();break;case"connectionMessage":!function(e){switch(e.what){case"start":!function(){if(o.focus(),self.addEventListener("scroll",F,{passive:!0}),self.addEventListener("resize",F,{passive:!0}),self.addEventListener("keydown",C,!0),n.mouse&&"number"==typeof vAPI.mouseClick.x&&vAPI.mouseClick.x>0&&0!==k(vAPI.mouseClick.x,vAPI.mouseClick.y))return $();const e=n.target||"",t=e.indexOf("\t");if(-1===t)return;const i=e.slice(0,t),r=e.slice(t+1),s={a:"href",audio:"src",embed:"src",iframe:"src",img:"src",video:"src"}[i];if(void 0===s)return;const l=document.getElementsByTagName(i);for(const e of l){if(e===o)continue;const t=e[s];if("string"==typeof t&&(t===r||""===t&&"about:blank"===r))return e.scrollIntoView({behavior:"smooth",block:"start"}),k(e),$({broad:!0})}N()}(),0===l.length&&p([],!0);break;case"optimizeCandidates":!function(e){const{candidates:n}=e,o=[];for(const e of n){let t=Number.MAX_SAFE_INTEGER,n="";for(let o=0,i=e.length;o<i;o++){const r=e.slice(i-o-1).join(""),s=document.querySelectorAll(r);s.length<t&&(n=r,t=s.length)}o.push({selector:`##${n}`,count:t})}o.sort(((e,t)=>{const n=t.count-e.count;return 0!==n?n:e.selector.length-t.selector.length})),vAPI.MessagingConnection.sendTo(t,{what:"candidatesOptimized",candidates:o.map((e=>e.selector)),slot:e.slot})}(e);break;case"dialogCreate":I.queryAll(e),I.preview(!0,!0),N();break;case"dialogSetFilter":{const n=I.queryAll(e)||[];if(p(n.map((e=>e.elem)),!0),"!"===e.filter)break;vAPI.MessagingConnection.sendTo(t,{what:"resultsetDetails",count:n.length,opt:0!==n.length?n[0].opt:void 0});break}case"quitPicker":I.preview(!1),N();break;case"highlightElementAtPoint":x(e.mx,e.my);break;case"unhighlight":p([]);break;case"filterElementAtPoint":i=e.mx,r=e.my,s=e.broad,0!==k(i,r)&&$({broad:s});break;case"zapElementAtPoint":E(e.mx,e.my,e.options),!0!==e.options.highlight&&!0!==e.options.stay&&N();break;case"togglePreview":I.preview(e.state),!1===e.state&&p(l,!0)}var i,r,s}(i.payload)}};{const e=await Promise.all([vAPI.messaging.extend(),vAPI.messaging.send("elementPicker",{what:"elementPickerArguments"})]);if(!0!==e[0])return;if(n=e[1],"object"!=typeof n||null===n)return;const t=n.eprom||null;null!==t&&t.lastNetFilterSession===u&&(f=t.lastNetFilterHostname||"",d=t.lastNetFilterUnion||"")}if(!0!==n.zap&&vAPI.domFilterer instanceof Object==0)return;const j=["background: transparent","border: 0","border-radius: 0","box-shadow: none","display: block","height: 100vh","left: 0","margin: 0","max-height: none","max-width: none","min-height: unset","min-width: unset","opacity: 1","outline: 0","padding: 0","pointer-events: auto","position: fixed","top: 0","visibility: visible","width: 100%","z-index: 2147483647",""];CSS.supports instanceof Function&&CSS.supports("color-scheme","initial")&&j.push("color-scheme: initial");const L=`\n:root > [${vAPI.sessionId}] {\n    ${j.join(" !important;")}\n}\n:root [${vAPI.sessionId}-clickblind] {\n    pointer-events: none !important;\n}\n`;vAPI.userStylesheet.add(L),vAPI.userStylesheet.apply(),o=document.createElement("iframe"),o.setAttribute(vAPI.sessionId,""),document.documentElement.append(o),vAPI.shutdown.add(N),vAPI.MessagingConnection.addListener(z);{const t=new URL(n.pickerURL);t.searchParams.set("epid",e),n.zap&&t.searchParams.set("zap","1"),o.contentWindow.location=t.href}})();