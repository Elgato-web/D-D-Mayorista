"use strict";{const e=/[-\/\\^$+?.()|[\]{}]/g,t=/\*/g,i=new Map,s=function(e){return e.startsWith("/")&&e.endsWith("/")||-1!==e.indexOf("/")&&-1!==e.indexOf("*")},n=function(s,n,r){if(-1===r.indexOf("/"))return n.endsWith(r)&&(n.length===r.length||"."===n.charAt(n.length-r.length-1));if(!1===r.startsWith("/")&&-1===r.indexOf("*"))return s===r;let o=i.get(r);if(void 0===o){let s;s=r.startsWith("/")&&r.endsWith("/")?r.slice(1,-1):r.replace(e,"\\$&").replace(t,".*"),o=new RegExp(s),i.set(r,o)}return o.test(s)},r=function(e,t,i,s){if(i)for(let r=s||0,o=i.length;r<o;r++)if(n(e,t,i[r]))return r;return-1};µBlock.getNetFilteringSwitch=function(e){const t=this.URI.hostnameFromURI(e);let i=t;for(;;){if(-1!==r(e,t,this.netWhitelist.get(i)))return!1;const s=i.indexOf(".");if(-1===s)break;i=i.slice(s+1)}return-1===r(e,t,this.netWhitelist.get("//"))},µBlock.toggleNetFilteringSwitch=function(e,t,i){const n=this.getNetFilteringSwitch(e);if(void 0===i&&(i=!n),i===n)return n;const o=this.netWhitelist,c=e.indexOf("#");let l=-1!==c?e.slice(0,c):e;const a=this.URI.hostnameFromURI(l);let h=a,d="page"===t?l:a;if(!1===i){let e=o.get(h);return void 0===e&&(e=[],o.set(h,e)),e.push(d),this.saveWhitelist(),!0}for(;;){const e=o.get(h);if(void 0!==e){let t;for(;t=r(l,a,e,t),-1!==t;)d=e.splice(t,1)[0],s(d)&&o.get("#").push(`# ${d}`);0===e.length&&o.delete(h)}const t=h.indexOf(".");if(-1===t)break;h=h.slice(t+1)}const u=o.get("//");if(void 0!==u){let e;for(;e=r(l,a,u,e),-1!==e;)d=u.splice(e,1)[0],s(d)&&o.get("#").push(`# ${d}`);0===u.length&&o.delete("//")}return this.saveWhitelist(),!0},µBlock.arrayFromWhitelist=function(e){const t=new Set;for(const i of e.values())for(const e of i)t.add(e);return Array.from(t).sort(((e,t)=>e.localeCompare(t)))},µBlock.stringFromWhitelist=function(e){return this.arrayFromWhitelist(e).join("\n")},µBlock.whitelistFromArray=function(e){const t=new Map;t.set("#",[]),i.clear();for(let s of e){if(s=s.trim(),""===s)continue;let e,n;if(s.startsWith("#"))e="#",n=s;else if(-1===s.indexOf("/"))this.reWhitelistBadHostname.test(s)?(e="#",n="# "+s):e=n=s;else if(s.length>2&&s.startsWith("/")&&s.endsWith("/")){e="//",n=s;try{const e=new RegExp(n.slice(1,-1));i.set(n,e)}catch(t){e="#",n="# "+s}}else{const t=this.reWhitelistHostnameExtractor.exec(s);t&&2===t.length?(e=t[1],n=s):(e="#",n="# "+s)}if(""===e)continue;let r=t.get(e);void 0===r&&(r=[],t.set(e,r)),r.push(n)}return t},µBlock.whitelistFromString=function(e){return this.whitelistFromArray(e.split("\n"))},µBlock.reWhitelistBadHostname=/[^a-z0-9.\-_\[\]:]/,µBlock.reWhitelistHostnameExtractor=/([a-z0-9.\-_\[\]]+)(?::[\d*]+)?\/(?:[^\x00-\x20\/]|$)[^\x00-\x20]*$/}µBlock.changeUserSettings=function(e,t){let i=this.userSettings;if(void 0===e)return i=JSON.parse(JSON.stringify(i)),i.noCosmeticFiltering=1===this.sessionSwitches.evaluate("no-cosmetic-filtering","*"),i.noLargeMedia=1===this.sessionSwitches.evaluate("no-large-media","*"),i.noRemoteFonts=1===this.sessionSwitches.evaluate("no-remote-fonts","*"),i.noScripting=1===this.sessionSwitches.evaluate("no-scripting","*"),i.noCSPReports=1===this.sessionSwitches.evaluate("no-csp-reports","*"),i;if("string"!=typeof e||""===e)return;if(void 0===t)return i[e];"largeMediaSize"===e&&("number"!=typeof t&&(t=parseInt(t,10)||0),t=Math.ceil(Math.max(t,0)));let s=i.hasOwnProperty(e)&&t!==i[e];switch(s&&(i[e]=t),e){case"advancedUserEnabled":!0===t&&(i.popupPanelSections|=31);break;case"autoUpdate":this.scheduleAssetUpdater(t?42e4:0);break;case"collapseBlocked":!1===t&&this.cosmeticFilteringEngine.removeFromSelectorCache("*","net");break;case"contextMenuEnabled":this.contextMenu.update(null);break;case"hyperlinkAuditingDisabled":this.privacySettingsSupported&&vAPI.browserSettings.set({hyperlinkAuditing:!t});break;case"noCosmeticFiltering":case"noLargeMedia":case"noRemoteFonts":case"noScripting":case"noCSPReports":let s;switch(e){case"noCosmeticFiltering":s="no-cosmetic-filtering";break;case"noLargeMedia":s="no-large-media";break;case"noRemoteFonts":s="no-remote-fonts";break;case"noScripting":s="no-scripting";break;case"noCSPReports":s="no-csp-reports"}if(void 0===s)break;let n=t?1:0;this.sessionSwitches.toggle(s,"*",n),this.permanentSwitches.toggle(s,"*",n)&&this.saveHostnameSwitches();break;case"prefetchingDisabled":this.privacySettingsSupported&&vAPI.browserSettings.set({prefetching:!t});break;case"webrtcIPAddressHidden":this.privacySettingsSupported&&vAPI.browserSettings.set({webrtcIPAddress:!t})}s&&this.saveUserSettings()},µBlock.changeHiddenSettings=function(e){const t=e.userResourcesLocation!==this.hiddenSettings.userResourcesLocation;this.hiddenSettings=e,this.saveHiddenSettings(),t&&(this.redirectEngine.invalidateResourcesSelfie(),this.loadRedirectResources()),this.fireDOMEvent("hiddenSettingsChanged")},µBlock.elementPickerExec=async function(e,t,i,s=!1){vAPI.isBehindTheSceneTabId(e)||(this.epickerArgs.target=i||"",this.epickerArgs.zap=s,!0!==s&&vAPI.tabs.executeScript(e,{file:"/lib/diff/swatinem_diff.js",runAt:"document_end"}),await vAPI.tabs.executeScript(e,{file:"/js/scriptlets/epicker.js",frameId:t,runAt:"document_end"}),vAPI.tabs.select(e))},µBlock.toggleFirewallRule=function(e){let{srcHostname:t,desHostname:i,requestType:s,action:n}=e;0!==n?this.sessionFirewall.setCell(t,i,s,n):this.sessionFirewall.unsetCell(t,i,s),e.persist&&(0!==n?this.permanentFirewall.setCell(t,i,s,n):this.permanentFirewall.unsetCell(t,i,s,n),this.savePermanentFirewallRules()),"*"===t||"*"!==s&&"image"!==s&&"3p"!==s&&"3p-frame"!==s||(t="*"),this.cosmeticFilteringEngine.removeFromSelectorCache(t,"net"),void 0!==e.tabId&&(s.startsWith("3p")&&this.updateToolbarIcon(e.tabId,4),"3p"===s&&3===n&&vAPI.tabs.executeScript(e.tabId,{file:"/js/scriptlets/load-3p-css.js",allFrames:!0,runAt:"document_idle"}))},µBlock.toggleURLFilteringRule=function(e){let t=this.sessionURLFiltering.setRule(e.context,e.url,e.type,e.action);!1!==t&&(this.cosmeticFilteringEngine.removeFromSelectorCache(e.context,"net"),!0===e.persist&&(t=this.permanentURLFiltering.setRule(e.context,e.url,e.type,e.action),t&&this.savePermanentFirewallRules()))},µBlock.toggleHostnameSwitch=function(e){let t=this.sessionSwitches.toggleZ(e.name,e.hostname,!!e.deep,e.state);if(!1!==t){switch(e.name){case"no-scripting":this.updateToolbarIcon(e.tabId,4);break;case"no-cosmetic-filtering":this.scriptlets.injectDeep(e.tabId,e.state?"cosmetic-off":"cosmetic-on");break;case"no-large-media":const t=this.pageStoreFromTabId(e.tabId);null!==t&&t.temporarilyAllowLargeMediaElements(!e.state)}!0===e.persist&&(t=this.permanentSwitches.toggleZ(e.name,e.hostname,!!e.deep,e.state),t&&this.saveHostnameSwitches())}},µBlock.blockingModeFromHostname=function(e){let t=0;if(this.sessionSwitches.evaluateZ("no-scripting",e)&&(t|=2),this.userSettings.advancedUserEnabled){const i=this.sessionFirewall;1===i.evaluateCellZY(e,"*","3p")&&(t|=4),1===i.evaluateCellZY(e,"*","3p-script")&&(t|=8),1===i.evaluateCellZY(e,"*","3p-frame")&&(t|=16)}return t},µBlock.parseBlockingProfiles=(()=>{const e=function(){const e=µBlock.hiddenSettings.blockingProfiles,t=[];e.split(/\s+/).forEach((e=>{let i=e.indexOf("/");-1===i&&(i=e.length);const s=parseInt(e.slice(0,i),2);if(isNaN(s))return;const n=e.slice(i+1);t.push({bits:s,color:""!==n?n:"#666"})})),µBlock.liveBlockingProfiles=t,µBlock.blockingProfileColorCache.clear()};return e(),self.addEventListener("hiddenSettingsChanged",(()=>{e()})),e})(),µBlock.logCosmeticFilters=function(e,t){vAPI.tabs.executeScript(e,{file:"/js/scriptlets/cosmetic-logger.js",frameId:t,matchAboutBlank:!0,runAt:"document_start"})},µBlock.scriptlets=function(){const e=new Map,t=function(e,t){return e+" "+t};return{inject:function(i,s,n){if("function"==typeof n){if(vAPI.isBehindTheSceneTabId(i))return void n();const r=t(i,s),o=e.get(r);if(void 0!==o)return void(n!==o.callback&&n());e.set(r,new class{constructor(e,t,i){this.tabId=e,this.scriptlet=t,this.callback=i,this.timer=vAPI.setTimeout(this.service.bind(this),1e3)}service(i){null!==this.timer&&(clearTimeout(this.timer),this.timer=null),e.delete(t(this.tabId,this.scriptlet)),this.callback(i)}}(i,s,n))}vAPI.tabs.executeScript(i,{file:`/js/scriptlets/${s}.js`})},injectDeep:function(e,t){vAPI.tabs.executeScript(e,{file:`/js/scriptlets/${t}.js`,allFrames:!0})},report:function(i,s,n){const r=t(i,s),o=e.get(r);void 0!==o&&o.service(n)}}}();