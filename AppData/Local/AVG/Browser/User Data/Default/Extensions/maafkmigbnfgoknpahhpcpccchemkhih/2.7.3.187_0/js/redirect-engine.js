"use strict";µBlock.redirectEngine=(()=>{const t=new Map([["1x1.gif",{alias:"1x1-transparent.gif",data:"blob"}],["2x2.png",{alias:"2x2-transparent.png",data:"blob"}],["3x2.png",{alias:"3x2-transparent.png",data:"blob"}],["32x32.png",{alias:"32x32-transparent.png",data:"blob"}],["addthis_widget.js",{alias:"addthis.com/addthis_widget.js"}],["amazon_ads.js",{alias:"amazon-adsystem.com/aax2/amzn_ads.js",data:"text"}],["amazon_apstag.js",{}],["ampproject_v0.js",{alias:"ampproject.org/v0.js"}],["chartbeat.js",{alias:"static.chartbeat.com/chartbeat.js"}],["click2load.html",{params:["aliasURL","url"]}],["doubleclick_instream_ad_status.js",{alias:"doubleclick.net/instream/ad_status.js",data:"text"}],["empty",{data:"text"}],["google-analytics_analytics.js",{alias:"google-analytics.com/analytics.js",data:"text"}],["google-analytics_cx_api.js",{alias:"google-analytics.com/cx/api.js"}],["google-analytics_ga.js",{alias:"google-analytics.com/ga.js",data:"text"}],["google-analytics_inpage_linkid.js",{alias:"google-analytics.com/inpage_linkid.js"}],["googlesyndication_adsbygoogle.js",{alias:"googlesyndication.com/adsbygoogle.js",data:"text"}],["googletagmanager_gtm.js",{alias:"googletagmanager.com/gtm.js",data:"text"}],["googletagservices_gpt.js",{alias:"googletagservices.com/gpt.js",data:"text"}],["hd-main.js",{}],["ligatus_angular-tag.js",{alias:"ligatus.com/*/angular-tag.js"}],["monkeybroker.js",{alias:"d3pkae9owd2lcf.cloudfront.net/mb105.js"}],["noeval.js",{data:"text"}],["noeval-silent.js",{alias:"silent-noeval.js",data:"text"}],["nobab.js",{alias:"bab-defuser.js",data:"text"}],["nofab.js",{alias:"fuckadblock.js-3.2.0",data:"text"}],["noop-0.1s.mp3",{alias:["noopmp3-0.1s","abp-resource:blank-mp3"],data:"blob"}],["noop-1s.mp4",{alias:"noopmp4-1s",data:"blob"}],["noop.html",{alias:"noopframe"}],["noop.js",{alias:["noopjs","abp-resource:blank-js"],data:"text"}],["noop.txt",{alias:"nooptext",data:"text"}],["noop-vmap1.0.xml",{alias:"noopvmap-1.0",data:"text"}],["outbrain-widget.js",{alias:"widgets.outbrain.com/outbrain.js"}],["popads.js",{alias:"popads.net.js",data:"text"}],["popads-dummy.js",{data:"text"}],["scorecardresearch_beacon.js",{alias:"scorecardresearch.com/beacon.js"}],["window.open-defuser.js",{alias:"nowoif.js",data:"text"}]]),e=new Map([["gif","image/gif"],["html","text/html"],["js","application/javascript"],["mp3","audio/mp3"],["mp4","video/mp4"],["png","image/png"],["txt","text/plain"],["xml","text/xml"]]),s=new Map([["main_frame","text/html"],["other","text/plain"],["script","application/javascript"],["stylesheet","text/css"],["sub_frame","text/html"],["xmlhttprequest","text/plain"]]),a=new Set(e.values()),o=function(t){const s=/\.([^.]+)$/.exec(t);if(null!==s)return e.get(s[1])},i=class{constructor(){this.mime="",this.data="",this.warURL=void 0,this.params=void 0}toURL(t,e=!1){if(void 0!==this.warURL&&!0!==e&&t instanceof Object&&"xmlhttprequest"!==t.type){let e=`${this.warURL}?secret=${vAPI.warSecret()}`;if(void 0!==this.params)for(const s of this.params){const a=t[s];void 0!==a&&(e+=`&${s}=${encodeURIComponent(a)}`)}return e}if(void 0!==this.data){if(""===this.data){const e=s.get(t.type);if(void 0===e)return;return`data:${e},`}return!1===this.data.startsWith("data:")&&(-1===this.mime.indexOf(";")?this.data=`data:${this.mime};base64,${btoa(this.data)}`:this.data=`data:${this.mime},${this.data}`),this.data}}toContent(){if(this.data.startsWith("data:")){const t=this.data.indexOf(","),e=this.data.endsWith(";base64",t);this.data=this.data.slice(t+1),e&&(this.data=atob(this.data))}return this.data}static fromContent(t,e){const s=new i;return s.mime=t,s.data=e,s}static fromSelfie(t){const e=new i;return e.mime=t.mime,e.data=t.data,e.warURL=t.warURL,e.params=t.params,e}},n=function(){this.aliases=new Map,this.resources=new Map,this.reset(),this.modifyTime=Date.now(),this.resourceNameRegister=""};n.prototype.reset=function(){},n.prototype.freeze=function(){},n.prototype.tokenToURL=function(t,e,s=!1){const a=this.resources.get(this.aliases.get(e)||e);if(void 0!==a)return this.resourceNameRegister=e,a.toURL(t,s)},n.prototype.hasToken=function(t){return"none"===t||(37===t.charCodeAt(0)&&(t=t.slice(1)),void 0!==this.resources.get(this.aliases.get(t)||t))},n.prototype.toSelfie=async function(){},n.prototype.fromSelfie=async function(){return!0},n.prototype.resourceContentFromName=function(t,e){const s=this.resources.get(this.aliases.get(t)||t);if(void 0!==s)return void 0===e||s.mime.startsWith(e)?s.toContent():void 0},n.prototype.resourcesFromString=function(t){const e=new µBlock.LineIterator(r(t)+"\n\n"),s=/\S/;let n,c,l;for(;!1===e.eot();){const t=e.next();if(t.startsWith("#"))continue;if(t.startsWith("// "))continue;if(void 0===n){if(""===t)continue;if(t.startsWith("/// ")){const e=t.slice(4).trim();n=[e,o(e)];continue}const e=t.trim().split(/\s+/);if(2!==e.length)continue;if("none"===e[0])continue;let s=e[1].indexOf(";");if(-1===s&&(s=e[1].length),!1===a.has(e[1].slice(0,s)))continue;c=-1!==e[1].indexOf(";"),n=e;continue}if(t.startsWith("/// ")){void 0===l&&(l=[]);const[e,s]=t.slice(4).trim().split(/\s+/);void 0!==s&&l.push({prop:e,value:s});continue}if(s.test(t)){n.push(c?t.trim():t);continue}const r=this.aliases.get(n[0])||n[0],p=n[1],d=µBlock.orphanizeString(n.slice(2).join(c?"":"\n"));if(this.resources.set(r,i.fromContent(p,d)),Array.isArray(l))for(const{prop:t,value:e}of l)"alias"===t&&this.aliases.set(e,r);n=void 0,l=void 0}this.modifyTime=Date.now()};const r=function(t){return t.replace(/^\/\*[\S\s]+?\n\*\/\s*/,"")};return n.prototype.loadBuiltinResources=function(){µBlock.assets.remove("ublock-resources"),this.resources=new Map,this.aliases=new Map;const e=[µBlock.assets.fetchText("/assets/resources/scriptlets.js").then((t=>{const e=t.content;"string"==typeof e&&0!==e.length&&this.resourcesFromString(e)}))],s=(e,s)=>{const a=t.get(e),n=i.fromSelfie({mime:o(e),data:s,warURL:vAPI.getURL(`/web_accessible_resources/${e}`),params:a.params});if(this.resources.set(e,n),void 0!==a.alias)if(Array.isArray(a.alias))for(const t of a.alias)this.aliases.set(t,e);else this.aliases.set(a.alias,e)},a=t=>{const e=/^\/web_accessible_resources\/([^?]+)/.exec(t.url);if(null===e)return;const a=e[1];return t.content instanceof Blob?((t,e)=>new Promise((a=>{const o=new FileReader;o.onload=()=>{s(t,o.result),a()},o.onabort=o.onerror=()=>{a()},o.readAsDataURL(e)})))(a,t.content):((t,e)=>{s(t,r(e))})(a,t.content)};for(const[o,i]of t)"string"==typeof i.data?e.push(µBlock.assets.fetch(`/web_accessible_resources/${o}?secret=${vAPI.warSecret()}`,{responseType:i.data}).then((t=>a(t)))):s(o);return Promise.all(e)},n.prototype.getResourceDetails=function(){const t=new Map([["none",{canInject:!1,canRedirect:!0,aliasOf:""}]]);for(const[e,s]of this.resources)t.set(e,{canInject:"string"==typeof s.data,canRedirect:void 0!==s.warURL,aliasOf:""});for(const[e,s]of this.aliases){const a=t.get(s);if(void 0===a)continue;const o=Object.assign({},a);o.aliasOf=s,t.set(e,o)}return Array.from(t).sort(((t,e)=>t[0].localeCompare(e[0])))},n.prototype.selfieFromResources=function(){µBlock.assets.put("compiled/redirectEngine/resources",JSON.stringify({version:5,aliases:Array.from(this.aliases),resources:Array.from(this.resources)}))},n.prototype.resourcesFromSelfie=async function(){const t=await µBlock.assets.get("compiled/redirectEngine/resources");let e;try{e=JSON.parse(t.content)}catch(t){}if(e instanceof Object==0||5!==e.version||!1===Array.isArray(e.resources))return!1;this.aliases=new Map(e.aliases),this.resources=new Map;for(const[t,s]of e.resources)this.resources.set(t,i.fromSelfie(s));return!0},n.prototype.invalidateResourcesSelfie=function(){µBlock.assets.remove("compiled/redirectEngine/resources")},new n})();