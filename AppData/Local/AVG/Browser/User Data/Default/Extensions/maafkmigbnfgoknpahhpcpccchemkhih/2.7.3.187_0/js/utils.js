"use strict";µBlock.formatCount=function(t){if("number"!=typeof t)return"";let e=t.toFixed(0);return t>=1e3&&(e=t<1e4?">"+e.slice(0,1)+"k":t<1e5?e.slice(0,2)+"k":t<1e6?e.slice(0,3)+"k":t<1e7?e.slice(0,1)+"M":e.slice(0,-6)+"M"),e},µBlock.dateNowToSensibleString=function(){return new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().replace(/\.\d+Z$/,"").replace(/:/g,".").replace("T","_")},µBlock.LineIterator=class{constructor(t,e){this.text=t,this.textLen=this.text.length,this.offset=e||0}next(t){void 0!==t&&(this.offset+=t);let e=this.text.indexOf("\n",this.offset);-1===e&&(e=this.text.indexOf("\r",this.offset),-1===e&&(e=this.textLen));const i=this.text.slice(this.offset,e);return this.offset=e+1,i}peek(t){const e=this.offset;return this.text.slice(e,e+t)}charCodeAt(t){return this.text.charCodeAt(this.offset+t)}eot(){return this.offset>=this.textLen}},µBlock.FieldIterator=class{constructor(t){this.text="",this.sep=t,this.sepLen=t.length,this.offset=0}first(t){return this.text=t,this.offset=0,this.next()}next(){let t=this.text.indexOf(this.sep,this.offset);-1===t&&(t=this.text.length);const e=this.text.slice(this.offset,t);return this.offset=t+this.sepLen,e}remainder(){return this.text.slice(this.offset)}},µBlock.CompiledLineIO={serialize:JSON.stringify,unserialize:JSON.parse,blockStartPrefix:"#block-start-",blockEndPrefix:"#block-end-",Writer:class{constructor(){this.io=µBlock.CompiledLineIO,this.blockId=void 0,this.block=void 0,this.stringifier=this.io.serialize,this.blocks=new Map,this.properties=new Map}push(t){this.block.push(this.stringifier(t))}last(){if(Array.isArray(this.block)&&0!==this.block.length)return this.block[this.block.length-1]}select(t){if(t!==this.blockId)return this.blockId=t,this.block=this.blocks.get(t),void 0===this.block&&this.blocks.set(t,this.block=[]),this}toString(){let t=[];for(let[e,i]of this.blocks)0!==i.length&&t.push(this.io.blockStartPrefix+e,i.join("\n"),this.io.blockEndPrefix+e);return t.join("\n")}},Reader:class{constructor(t,e){this.io=µBlock.CompiledLineIO,this.block="",this.len=0,this.offset=0,this.line="",this.parser=this.io.unserialize,this.blocks=new Map,this.properties=new Map;let i=new RegExp(`^${this.io.blockStartPrefix}(\\d+)\\n`,"gm"),s=i.exec(t);for(;null!==s;){let e=s.index+s[0].length,n=t.indexOf(this.io.blockEndPrefix+s[1],e);this.blocks.set(parseInt(s[1],10),t.slice(e,n)),i.lastIndex=n,s=i.exec(t)}void 0!==e&&this.select(e)}next(){if(this.offset===this.len)return this.line="",!1;let t=this.block.indexOf("\n",this.offset);return-1!==t?(this.line=this.block.slice(this.offset,t),this.offset=t+1):(this.line=this.block.slice(this.offset),this.offset=this.len),!0}select(t){return this.block=this.blocks.get(t)||"",this.len=this.block.length,this.offset=0,this}fingerprint(){return this.line}args(){return this.parser(this.line)}}},µBlock.openNewTab=function(t){if(t.url.startsWith("logger-ui.html")&&(t.shiftKey&&this.changeUserSettings("alwaysDetachLogger",!this.userSettings.alwaysDetachLogger),this.userSettings.alwaysDetachLogger)){t.popup=this.hiddenSettings.loggerPopupType;const e=new URL(vAPI.getURL(t.url));let i;e.searchParams.set("popup","1"),t.url=e.href;try{i=JSON.parse(vAPI.localStorage.getItem("popupLoggerBox"))}catch(t){}void 0!==i&&(t.box=i)}vAPI.tabs.open(t)},µBlock.MRUCache=class{constructor(t){this.size=t,this.array=[],this.map=new Map,this.resetTime=Date.now()}add(t,e){const i=this.map.has(t);this.map.set(t,e),i||(this.array.length===this.size&&this.map.delete(this.array.pop()),this.array.unshift(t))}remove(t){this.map.has(t)&&this.array.splice(this.array.indexOf(t),1)}lookup(t){const e=this.map.get(t);if(void 0!==e&&this.array[0]!==t){let e=this.array.indexOf(t);do{this.array[e]=this.array[e-1]}while(--e);this.array[0]=t}return e}reset(){this.array=[],this.map.clear(),this.resetTime=Date.now()}},µBlock.escapeRegex=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},µBlock.decomposeHostname=(()=>{const t=/[g-z_-]/,e=/\.\d+$/,i=function(t){const e=t.indexOf(".");return-1!==e?t.slice(e+1):"*"!==t&&""!==t?"*":""},s=function(t){if("*"===t||""===t)return"";const e=t.lastIndexOf(".");return-1===e?"*":t.slice(0,e)},n=function(t){return"*"!==t&&""!==t?"*":""};return function(r,o){if(0===o.length||o[0]!==r){let c;!1===t.test(r)&&(e.test(r)?c=s:r.startsWith("[")&&(c=n)),void 0===c&&(c=i),o[0]=r;let h=1;for(;""!==(r=c(r));)o[h++]=r;o.length=h}return o}})(),µBlock.orphanizeString=function(t){return JSON.parse(JSON.stringify(t))};{const t=new Uint8Array(64),e=new Uint8Array(128);{const i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz@%";for(let s=0,n=i.length;s<n;s++){const n=i.charCodeAt(s);t[s]=n,e[n]=s}}µBlock.base64={magic:"Base64_1",encode:function(e,i){const s=i+3>>>2,n=new Uint32Array(e,0,s),r=this.magic.length+7+7*s,o=new Uint8Array(r);let c=0;for(let t=0;t<this.magic.length;t++)o[c++]=this.magic.charCodeAt(t);let h=s;do{o[c++]=t[63&h],h>>>=6}while(0!==h);o[c++]=32;for(let e=0;e<s;e++){h=n[e];do{o[c++]=t[63&h],h>>>=6}while(0!==h);o[c++]=32}return"undefined"==typeof TextDecoder?JSON.stringify(Array.from(new Uint32Array(o.buffer,0,c>>>2))):(new TextDecoder).decode(new Uint8Array(o.buffer,0,c))},decode:function(t,i){if(91===t.charCodeAt(0)){const e=JSON.parse(t);if(i instanceof ArrayBuffer==0)return new Uint32Array(e);const s=new Uint32Array(i);return s.set(e),s}if(!1===t.startsWith(this.magic))throw new Error("Invalid µBlock.base64 encoding");const s=t.length,n=this.decodeSize(t)>>2,r=i instanceof ArrayBuffer==0?new Uint32Array(n):new Uint32Array(i);let o=t.indexOf(" ",this.magic.length)+1;if(-1===o)throw new Error("Invalid µBlock.base64 encoding");let c=0;for(;!(c===n||o>=s);){let i=0,s=0;for(;;){const n=t.charCodeAt(o++);if(32===n)break;i+=e[n]<<s,s+=6}r[c++]=i}if(o<s||c<n)throw new Error("Invalid µBlock.base64 encoding");return r},decodeSize:function(t){if(!1===t.startsWith(this.magic))return 0;let i=0,s=0,n=this.magic.length;for(;;){const r=t.charCodeAt(n++);if(32===r)break;i+=e[r]<<s,s+=6}return i<<2}},µBlock.denseBase64={magic:"DenseBase64_1",encode:function(e){const i=e.length%3,s=e.length-i;let n=s/3*4;0!==i&&(n+=i+1);const r=new Uint8Array(n);let o=0;for(let i=0;i<s;i+=3){const s=e[i+0],n=e[i+1],c=e[i+2];r[o+0]=t[s>>>2],r[o+1]=t[s<<4&48|n>>>4],r[o+2]=t[n<<2&60|c>>>6],r[o+3]=t[63&c],o+=4}if(0!==i){const n=e[s];if(r[o+0]=t[n>>>2],1===i)r[o+1]=t[n<<4&48];else{const i=e[s+1];r[o+1]=t[n<<4&48|i>>>4],r[o+2]=t[i<<2&60]}}const c=(new TextDecoder).decode(r);return this.magic+c},decode:function(t,i){if(!1===t.startsWith(this.magic))throw new Error("Invalid µBlock.denseBase64 encoding");const s=this.decodeSize(t),n=i instanceof ArrayBuffer==0?new Uint8Array(s):new Uint8Array(i),r=t.length-this.magic.length;let o=this.magic.length,c=0;const h=3&r,a=o+r-h;for(;o<a;){const i=e[t.charCodeAt(o+0)],s=e[t.charCodeAt(o+1)],r=e[t.charCodeAt(o+2)],h=e[t.charCodeAt(o+3)];o+=4,n[c+0]=i<<2|s>>>4,n[c+1]=s<<4&240|r>>>2,n[c+2]=r<<6&192|h,c+=3}if(0!==h){const i=e[t.charCodeAt(o+0)],s=e[t.charCodeAt(o+1)];if(n[c+0]=i<<2|s>>>4,3===h){const i=e[t.charCodeAt(o+2)];n[c+1]=s<<4&240|i>>>2}}return n},decodeSize:function(t){if(!1===t.startsWith(this.magic))return 0;const e=t.length-this.magic.length,i=3&e;let s=3*(e-i>>>2);return 0!==i&&(s+=i-1),s}}}µBlock.loadBenchmarkDataset=(()=>{let t,e;return function(){if(void 0!==e&&(clearTimeout(e),e=void 0),vAPI.setTimeout((()=>{e=void 0,t=void 0}),3e5),void 0!==t)return t;const i=µBlock.hiddenSettings.benchmarkDatasetURL;return"unset"===i?(console.info("No benchmark dataset available."),Promise.resolve()):(console.info("Loading benchmark dataset..."),t=µBlock.assets.fetchText(i).then((t=>{console.info("Parsing benchmark dataset...");const e=[],i=new µBlock.LineIterator(t.content);for(;!1===i.eot();){let t;try{t=JSON.parse(i.next())}catch(t){}t instanceof Object!=0&&t.frameUrl&&t.url&&("document"===t.cpt?t.cpt="main_frame":"xhr"===t.cpt&&(t.cpt="xmlhttprequest"),e.push(t))}return e})).catch((e=>{console.info(`Not found: ${e.url}`),t=void 0})),t)}})(),µBlock.fireDOMEvent=function(t){window instanceof Object&&window.dispatchEvent instanceof Function&&window.CustomEvent instanceof Function&&window.dispatchEvent(new CustomEvent(t))},µBlock.getModifiedSettings=function(t,e={}){const i={};for(const s in t)e.hasOwnProperty(s)&&t[s]!==e[s]&&(i[s]=t[s]);return i},µBlock.settingValueFromString=function(t,e,i){if("string"!=typeof e||"string"!=typeof i)return;if(!1===t.hasOwnProperty(e))return;let s;switch(typeof t[e]){case"boolean":"true"===i?s=!0:"false"===i&&(s=!1);break;case"string":s=i.trim();break;case"number":s=i.startsWith("0b")?parseInt(i.slice(2),2):i.startsWith("0x")?parseInt(i.slice(2),16):parseInt(i,10),isNaN(s)&&(s=void 0)}return s};