"use strict";(()=>{const e=uDom.nodeFromId("showdom");if("undefined"==typeof Map||Map.polyfill||"undefined"==typeof WeakMap)return void e.classList.add("disabled");var t,n=self.logger,o=0,i="",r=uDom.nodeFromId("domInspector"),l=uDom.nodeFromId("domTree"),a=1,s=new Map;const c=vAPI.messaging;vAPI.MessagingConnection.addListener((function(e){if("domInspector"===e.from&&"loggerUI"===e.to)switch(e.what){case"connectionBroken":t===e.id&&(s.clear(),n.removeAllChildren(l),t=void 0),S();break;case"connectionMessage":"domLayoutFull"===e.payload.what?(e.payload.url,i=e.payload.hostname,u(e.payload)):"domLayoutIncremental"===e.payload.what&&v(e.payload);break;case"connectionRequested":if(void 0===e.tabId||e.tabId!==o)return;return s.clear(),n.removeAllChildren(l),t=e.id,!0}}));const d=function(e){var t,n,o=document.createElement("li");return o.setAttribute("id",e.nid),o.appendChild(document.createElement("span")),(t=document.createElement("code")).textContent=e.sel,o.appendChild(t),n=e.cnt||0,(t=document.createElement("span")).textContent=0!==n?n.toLocaleString():"",t.setAttribute("data-cnt",n),o.appendChild(t),void 0===e.filter||((t=document.createElement("code")).classList.add("filter"),void 0===(n=s.get(e.filter))&&(n=a.toString(),s.set(e.filter,n),a+=1),t.setAttribute("data-filter-id",n),t.textContent=e.filter,o.appendChild(t),o.classList.add("isCosmeticHide")),o},m=function(e,t){if(e.appendChild(t),!1!==t.classList.contains("isCosmeticHide"))for(;null!==(t=t.parentElement.parentElement);)t.classList.add("hasCosmeticHide")},u=function(e){var t=l.parentElement,o=t.removeChild(l);n.removeAllChildren(l),s.clear();for(var i,r,a=0,c=e.layout,u=c.length,f=0;f<u;f++)if((r=c[f]).lvl!==a)if(r.lvl>a)o=document.createElement("ul"),i.appendChild(o),i.classList.add("branch"),i=d(r),m(o,i),a=r.lvl;else{for(;r.lvl<a;)o=(i=(o=i.parentNode).parentNode).parentNode,a-=1;i=d(r),m(o,i)}else i=d(r),m(o,i);for(;null!==o.parentNode;)o=o.parentNode;o.firstElementChild.classList.add("show"),t.appendChild(l)},f=function(e,t){var n,o,i=e.parentElement.parentElement,r=t>=0&&e.classList.contains("isCosmeticHide")&&!1===i.classList.contains("hasCosmeticHide");for(t<0&&(t-=p(e));"li"===i.localName;i=i.parentElement.parentElement)n=i.children[2],0!==t&&(o=p(i)+t,n.textContent=0!==o?o.toLocaleString():"",n.setAttribute("data-cnt",o)),r&&i.classList.add("hasCosmeticHide")},v=function(e){for(var t,n,o,i,r=e.journal,l=new Map(e.nodes),a=0,s=r.length;a<s;a++)if(-1!==(t=r[a]).what){if(0!==t.what)if(1===t.what&&t.l){if(null===(n=document.getElementById(t.l)))continue;i=n.parentElement,o=d(l.get(t.nid)),i.insertBefore(o,n.nextElementSibling),f(o,1)}else if(1===t.what&&t.u){if(null===(o=document.getElementById(t.u)))continue;null===(i=o.querySelector("ul"))&&(i=document.createElement("ul"),o.appendChild(i),o.classList.add("branch")),o=d(l.get(t.nid)),i.appendChild(o),f(o,1)}}else{if(null===(o=document.getElementById(t.nid)))continue;f(o,-1),o.parentNode.removeChild(o)}},p=function(e){var t=e.children[2],n=parseInt(t.getAttribute("data-cnt"),10);return isNaN(n)?0:n},g=function(e){for(var t,n="";null!==e&&("li"!==e.localName||null===(t=e.querySelector("code"))||-1===(n=t.textContent+" > "+n).indexOf("#"));)e=e.parentElement;return n.slice(0,-3)},h=function(e){for(;null!==e;){if("li"===e.localName){var t=e.querySelector("code:nth-of-type(2)");if(null!==t)return t.textContent}e=e.parentElement}return""},L=function(e){for(var t=e;null!==t;){if("li"===t.localName)return t.id||"";t=t.parentElement}return""},C=function(){let e,r,a,s=[],d=[];const m=function(){const e=function(){a=void 0,s=[],d=[];const e=/^([^#]*)(#@?#)(.+)$/;for(let t of r.value.split(/\s*\n\s*/)){if(t=t.trim(),""===t||"!"===t.charAt(0))continue;const n=e.exec(t);null!==n&&4===n.length&&-1!==i.lastIndexOf(n[1])&&("##"===n[2]?s.push(n[3]):d.push(n[3]))}f()};return function(){void 0===a&&(a=vAPI.setTimeout(e,743))}}(),u=function(e){var t=e.target;if(e.stopPropagation(),"createCosmeticFilters"===t.id)return c.send("loggerUI",{what:"createUserFilter",filters:r.value}),c.send("loggerUI",{what:"reloadTab",tabId:o}),v()},f=function(){vAPI.MessagingConnection.sendTo(t,{what:"showCommitted",hide:s.join(",\n"),unhide:d.join(",\n")})},v=function(){void 0!==a&&(clearTimeout(a),a=void 0),vAPI.MessagingConnection.sendTo(t,{what:"showInteractive",hide:s.join(",\n"),unhide:d.join(",\n")}),r.removeEventListener("input",m),e.removeEventListener("click",u,!0),e=void 0,r=void 0,s=[],d=[]};return function(){e=n.modalDialog.create("#cosmeticFilteringDialog",v),r=e.querySelector("textarea"),s=[];for(const e of l.querySelectorAll("code.off"))e.classList.contains("filter")||s.push(g(e));const t=[];for(const e of s)t.push(i+"##"+e);const o=new Set;for(const e of l.querySelectorAll("code.filter.off")){const n=e.getAttribute("data-filter-id");o.has(n)||(o.add(n),d.push(e.textContent),t.push(i+"#@#"+e.textContent))}r.value=t.join("\n"),r.addEventListener("input",m),e.addEventListener("click",u,!0),f(),n.modalDialog.show()}}(),E=function(e){if(e.stopPropagation(),0!==o){var n=e.target,i=n.parentElement;if("span"===n.localName&&i instanceof HTMLLIElement&&i.classList.contains("branch")&&n===i.firstElementChild){if(!i.classList.toggle("show"))for(var a of i.querySelectorAll(".branch"))a.classList.remove("show")}else if("code"===n.localName){n.classList.contains("filter")?(vAPI.MessagingConnection.sendTo(t,{what:"toggleFilter",original:!1,target:n.classList.toggle("off"),selector:g(n),filter:h(n),nid:L(n)}),uDom('[data-filter-id="'+n.getAttribute("data-filter-id")+'"]',r).toggleClass("off",n.classList.contains("off"))):vAPI.MessagingConnection.sendTo(t,{what:"toggleNodes",original:!0,target:!1===n.classList.toggle("off"),selector:g(n),nid:L(n)});var s=null===l.querySelector(".off");r.querySelector(".permatoolbar .revert").classList.toggle("disabled",s),r.querySelector(".permatoolbar .commit").classList.toggle("disabled",s)}}},I=(b=null,w=null,y=function(){w=null,vAPI.MessagingConnection.sendTo(t,{what:"highlightOne",selector:g(b),nid:L(b),scrollTo:!0})},function(e){if(0!==o&&!e.shiftKey){for(var t=e.target;null!==t&&"li"!==t.localName;)t=t.parentElement;t!==b&&(b=t,null===w&&(w=vAPI.setTimeout(y,50)))}});var b,w,y;const A=function(){return!1===e.classList.contains("active")?0:n.tabIdFromPageSelector()},S=function(){const e=A();e<=0||(o=e,c.send("loggerUI",{what:"scriptlet",tabId:e,scriptlet:"dom-inspector"}))},F=function(){void 0!==t&&(vAPI.MessagingConnection.disconnectFrom(t),t=void 0),n.removeAllChildren(l),r.classList.remove("vExpanded"),o=0},T=function(){const e=A();if(e<=0)return x();o!==e&&(F(),S())},D=function(){var e=r.classList.toggle("vExpanded"),t=document.querySelectorAll("#domInspector li.branch");for(var n of t)n.classList.toggle("show",e)},k=function(){r.classList.toggle("hCompact")},N=function(){uDom("#domTree .off").removeClass("off"),vAPI.MessagingConnection.sendTo(t,{what:"resetToggledNodes"}),r.querySelector(".permatoolbar .revert").classList.add("disabled"),r.querySelector(".permatoolbar .commit").classList.add("disabled")},x=function(){e.classList.remove("active"),uDom.nodeFromId("inspectors").classList.remove("dom"),F(),window.removeEventListener("beforeunload",x),document.removeEventListener("tabIdChanged",T),l.removeEventListener("click",E,!0),l.removeEventListener("mouseover",I,!0),uDom.nodeFromSelector("#domInspector .vCompactToggler").removeEventListener("click",D),uDom.nodeFromSelector("#domInspector .hCompactToggler").removeEventListener("click",k),uDom.nodeFromSelector("#domInspector .permatoolbar .revert").removeEventListener("click",N),uDom.nodeFromSelector("#domInspector .permatoolbar .commit").removeEventListener("click",C),o=0};e.addEventListener("click",(function(){e.classList.toggle("active")?(uDom.nodeFromId("inspectors").classList.add("dom"),window.addEventListener("beforeunload",x),document.addEventListener("tabIdChanged",T),l.addEventListener("click",E,!0),l.addEventListener("mouseover",I,!0),uDom.nodeFromSelector("#domInspector .vCompactToggler").addEventListener("click",D),uDom.nodeFromSelector("#domInspector .hCompactToggler").addEventListener("click",k),uDom.nodeFromSelector("#domInspector .permatoolbar .revert").addEventListener("click",N),uDom.nodeFromSelector("#domInspector .permatoolbar .commit").addEventListener("click",C),S()):x(),n.resize()}))})();