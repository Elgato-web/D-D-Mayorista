"use strict";µBlock.URLNetFiltering=(()=>{const t={1:"block",2:"allow",3:"noop"},e={block:1,allow:2,noop:3},r=new Set(["doc","main_frame"]),o=function(t,e){this.url=t,this.action=e},i=function(t,e){const r=e.length;for(let o=0;o<t.length;o++){const i=t[o];if(i.url.length>r)break;if(i.url===e)return o}return-1},n=function(t,e){const r=e.length;let o=t.length;for(;o--&&!(t[o].url.length<=r););if(-1!==o)do{if(e.startsWith(t[o].url))return o}while(o--);return-1},s=function(){this.reset()};return s.prototype.reset=function(){this.rules=new Map,this.context="",this.url="",this.type="",this.r=0,this.changed=!1,this.decomposedSource=[]},s.prototype.assign=function(t){for(const e of this.rules.keys())!1===t.rules.has(e)&&this.rules.delete(e);for(const e of t.rules)this.rules.set(e[0],e[1].slice());this.changed=!0},s.prototype.setRule=function(t,e,r,n){if(0===n)return this.removeRule(t,e,r);const s=t+" "+r;let l=this.rules.get(s);void 0===l&&(l=[],this.rules.set(s,l));const u=i(l,e);if(-1!==u){const t=l[u];if(t.action===n)return!1;t.action=n}else!function(t,e,r){const i=new o(e,r),n=function(t,e){for(let r=0;r<t.length;r++)if(t[r].url.length>e)return r;return-1}(t,e.length);-1===n?t.push(i):t.splice(n,0,i)}(l,e,n);return this.changed=!0,!0},s.prototype.removeRule=function(t,e,r){const o=t+" "+r,n=this.rules.get(o);if(void 0===n)return!1;const s=i(n,e);return-1!==s&&(n.splice(s,1),0===n.length&&this.rules.delete(o),this.changed=!0,!0)},s.prototype.evaluateZ=function(t,e,r){if(this.r=0,0===this.rules.size)return 0;µBlock.decomposeHostname(t,this.decomposedSource);for(let t of this.decomposedSource){this.context=t;let o=this.rules.get(t+" "+r);if(void 0!==o){let t=n(o,e);if(-1!==t){let e=o[t];return this.url=e.url,this.type=r,this.r=e.action,this.r}}if(o=this.rules.get(t+" *"),void 0!==o){let t=n(o,e);if(-1!==t){let e=o[t];return this.url=e.url,this.type="*",this.r=e.action,this.r}}}return 0},s.prototype.mustAllowCellZ=function(t,e,r){return 2===this.evaluateZ(t,e,r).r},s.prototype.mustBlockOrAllow=function(){return 1===this.r||2===this.r},s.prototype.toLogData=function(){if(0!==this.r)return{source:"dynamicUrl",result:this.r,rule:[this.context,this.url,this.type,this.intToActionMap.get(this.r)],raw:this.context+" "+this.url+" "+this.type+" "+this.intToActionMap.get(this.r)}},s.prototype.intToActionMap=new Map([[1," block"],[2," allow"],[3," noop"]]),s.prototype.copyRules=function(t,e,r,o){let i=r.length;for(;i--;){const n=r[i];t.evaluateZ(e,n,o);const s=0!==t.r&&t.context===e&&t.url===n&&t.type===o;this.evaluateZ(e,n,o);const l=0!==this.r&&this.context===e&&this.url===n&&this.type===o;s&&!l&&(this.setRule(e,n,o,t.r),this.changed=!0),!s&&l&&(this.removeRule(e,n,o),this.changed=!0)}return this.changed},s.prototype.toArray=function(){const e=[];for(var r of this.rules){const o=r[0];let i=o.indexOf(" ");const n=o.slice(0,i);i=o.lastIndexOf(" ");const s=o.slice(i+1),l=r[1];for(let r=0;r<l.length;r++){const o=l[r];e.push(n+" "+o.url+" "+s+" "+t[o.action])}}return e},s.prototype.toString=function(){return this.toArray().sort().join("\n")},s.prototype.fromString=function(t){this.reset();const e=new µBlock.LineIterator(t);for(;!1===e.eot();)this.addFromRuleParts(e.next().trim().split(/\s+/))},s.prototype.validateRuleParts=function(t){if(4===t.length&&!(t[1].indexOf("://")<=0||/[^a-z_-]/.test(t[2])&&"*"!==t[2]||r.has(t[2])||!1===e.hasOwnProperty(t[3])))return t},s.prototype.addFromRuleParts=function(t){return void 0!==this.validateRuleParts(t)&&(this.setRule(t[0],t[1],t[2],e[t[3]]),!0)},s.prototype.removeFromRuleParts=function(t){return void 0!==this.validateRuleParts(t)&&(this.removeRule(t[0],t[1],t[2]),!0)},s})(),µBlock.sessionURLFiltering=new µBlock.URLNetFiltering,µBlock.permanentURLFiltering=new µBlock.URLNetFiltering;