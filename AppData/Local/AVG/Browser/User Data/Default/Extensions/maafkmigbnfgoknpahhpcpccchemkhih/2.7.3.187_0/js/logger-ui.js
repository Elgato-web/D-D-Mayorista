"use strict";(()=>{const t=vAPI.messaging,e=self.logger={ownerId:Date.now()},n=new Date,o=6e4*n.getTimezoneOffset(),i=[];let r,a,s=[],l=0,c=0,d=!1,u=0,p=!1,m=!1;const g=e.tabIdFromPageSelector=function(){const t=uDom.nodeFromId("pageSelector").value;return"_"!==t?parseInt(t,10)||0:c},h=(()=>{const t=uDom.nodeFromId("modalOverlay"),n=t.querySelector(":scope > div > div:nth-of-type(1)"),o=t.querySelector(":scope > div > div:nth-of-type(2)");let i;const r=e.removeAllChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},a=function(){t.classList.remove("on");const e=n.firstElementChild;r(n),"function"==typeof i&&i(e),i=void 0},s=function(e){e.target!==t&&e.target!==o||a()};return t.addEventListener("click",s),o.addEventListener("click",s),{create:function(t,e){const o=document.querySelector(t).cloneNode(!0);return r(n),n.appendChild(o),i=e,o},show:function(){t.classList.add("on")},destroy:a}})();self.logger.modalDialog=h;const f={main_frame:"doc",stylesheet:"css",sub_frame:"frame",xmlhttprequest:"xhr"},y={doc:"main_frame",css:"stylesheet",frame:"sub_frame",xhr:"xmlhttprequest"};let v,x=new Map;const b=function(t){return t<10?"0"+t:t},C=function(t){return"string"==typeof t&&""!==t?t:""},w=function(t){if(t instanceof Object==0)return;const e=w.prototype;for(const n in e)t.hasOwnProperty(n)&&t[n]!==e[n]&&(this[n]=t[n]);this.type=t.stype||t.type,void 0!==t.aliasURL&&(this.aliased=!0),""===this.tabDomain&&(this.tabDomain=this.tabHostname||""),""===this.docDomain&&(this.docDomain=this.docHostname||""),""===this.domain&&(this.domain=t.hostname||"")};w.prototype={aliased:!1,dead:!1,docDomain:"",docHostname:"",domain:"",filter:void 0,id:"",realm:"",tabDomain:"",tabHostname:"",tabId:void 0,textContent:"",tstamp:0,type:"",voided:!1};const I=function(t,e){const i=new w;i.tstamp=t.tstamp,i.realm="message",i.tabId=t.tabId,i.type="tabLoad",i.textContent="";const r=[];return n.setTime(i.tstamp-o),r.push(b(n.getUTCHours())+":"+b(n.getUTCMinutes())+":"+b(n.getSeconds()),e),i.textContent=r.join("\t"),t.voided&&(i.voided=!0),i},E=function(t){const e=new w(t),i=[];if(n.setTime(t.tstamp-o),i.push(b(n.getUTCHours())+":"+b(n.getUTCMinutes())+":"+b(n.getSeconds())),"message"===t.realm)return i.push(t.text),e.textContent=i.join("\t"),e;if(void 0!==e.filter?(i.push(e.filter.raw),1===e.filter.result?i.push("--"):2===e.filter.result?i.push("++"):3===e.filter.result?i.push("**"):"redirect"===e.filter.source?i.push("<<"):i.push("")):i.push("",""),i.push(C(e.docHostname)),"network"===e.realm&&"string"==typeof e.domain&&""!==e.domain){let t="";void 0!==e.tabDomain?(e.tabId<0&&(t+="0,"),t+=e.domain===e.tabDomain?"1":"3"):t+="?",e.docDomain!==e.tabDomain&&(t+=",",void 0!==e.docDomain?t+=e.domain===e.docDomain?"1":"3":t+="?"),i.push(t)}else i.push("");return i.push(C(f[e.type]||e.type)),i.push(C(t.url)),e.aliased&&i.push(`aliasURL=${t.aliasURL}`),e.textContent=i.join("\t"),e},A=(()=>{const t=document.getElementById("vwRenderer"),e=document.getElementById("vwScroller"),n=document.getElementById("vwVirtualContent"),o=document.getElementById("vwContent"),i=document.getElementById("vwLineSizer"),r=document.querySelector("#logEntryTemplate > div"),a=[];let l,c,d=0,u=0,p=0,m=0,g=0;const h=function(){this.div=document.createElement("div"),this.div.className="logEntry",o.appendChild(this.div),this.logEntry=void 0};h.prototype={dispose:function(){o.removeChild(this.div)}};e.addEventListener("scroll",(function(){void 0===l&&(l=setTimeout((()=>{l=requestAnimationFrame((()=>{l=void 0,function(){const t=e.scrollTop;var n;0!=t-m&&(m=t,s.length<=2||(x((n=t,0!==u?Math.floor(n/u):0))&&b(),v(),o.style.top=`${m}px`))}()}))}),31.25))}),{passive:!0});const f=function(){void 0===c&&(c=setTimeout((()=>{c=requestAnimationFrame((()=>{c=void 0,function(){d=t.clientHeight,o.style.height=`${e.clientHeight}px`;const n=uDom.nodeFromSelector("#netInspector .vCompactToggler").classList.contains("vExpanded");let r=i.querySelector(".oneLine").clientHeight;n&&(r*=q.linesPerEntry);const s=0!==r?Math.ceil(d/r)+1:0;if(s>a.length)do{a.push(new h)}while(s>a.length);else if(s<a.length)do{a.pop().dispose()}while(s<a.length);const l=Array.from(i.querySelectorAll(".oneLine span")).map(((t,e)=>!1!==q.columns[e]?t.clientWidth+1:0)),c=l[0]+l[2]+l[4]+l[5];l[6]=.5,0===l[1]&&0===l[3]?l[6]=1:0===l[1]?(l[3]=.35,l[6]=.65):0===l[3]?(l[1]=.35,l[6]=.65):(l[1]=.25,l[3]=.25,l[6]=.5);const p=document.getElementById("vwRendererRuntimeStyles"),m=["#vwContent .logEntry {",`  height: ${r}px;`,"}","#vwContent .logEntry > div > span:nth-of-type(1) {",`  width: ${l[0]}px;`,"}","#vwContent .logEntry > div > span:nth-of-type(2) {",`  width: calc(calc(100% - ${c}px) * ${l[1]});`,"}","#vwContent .logEntry > div.messageRealm > span:nth-of-type(2) {",`  width: calc(100% - ${l[0]}px);`,"}","#vwContent .logEntry > div > span:nth-of-type(3) {",`  width: ${l[2]}px;`,"}","#vwContent .logEntry > div > span:nth-of-type(4) {",`  width: calc(calc(100% - ${c}px) * ${l[3]});`,"}","#vwContent .logEntry > div > span:nth-of-type(5) {",`  width: ${l[4]}px;`,"}","#vwContent .logEntry > div > span:nth-of-type(6) {",`  width: ${l[5]}px;`,"}","#vwContent .logEntry > div > span:nth-of-type(7) {",`  width: calc(calc(100% - ${c}px) * ${l[6]});`,"}",""];for(let t=0;t<l.length;t++)0===l[t]&&m.push(`#vwContent .logEntry > div > span:nth-of-type(${t+1}) {`,"  display: none;","}");p.textContent=m.join("\n"),u=r,v(),uDom.nodeFromId("netInspector").classList.toggle("vExpanded",n),C(0)}()}))}),125))};window.addEventListener("resize",f,{passive:!0}),f();const y=function(t,e){if(e>=s.length)return t.logEntry=void 0,null;const n=s[e];if(t.logEntry===n)return t.div.firstElementChild;t.logEntry=n;const o=n.textContent.split("\t"),i=r.cloneNode(!0),a=i.classList;let l;if(void 0!==n.realm&&a.add(n.realm+"Realm"),l=i.children[0],l.textContent=o[0],void 0!==n.tabId&&(i.setAttribute("data-tabid",n.tabId),n.voided&&a.add("voided")),"message"===n.realm)return void 0!==n.type&&i.setAttribute("data-type",n.type),l=i.children[1],l.textContent=o[1],i;"network"!==n.realm&&"cosmetic"!==n.realm||a.add("canDetails");const c=n.filter||void 0;let d,u;if(void 0!==c&&("string"==typeof c.source&&(d=c.source),"static"===d?(a.add("canLookup"),!0===c.modifier&&i.setAttribute("data-modifier","")):"cosmetic"===d&&(a.add("canLookup"),a.toggle("isException",c.raw.startsWith("#@#")))),l=i.children[1],!1===function(t,e){if(35!==e.charCodeAt(0))return!1;const n=/^#@?#/.exec(e);if(null===n)return!1;let o=document.createElement("span");return o.textContent=n[0],t.appendChild(o),o=document.createElement("span"),o.textContent=e.slice(n[0].length),t.appendChild(o),!0}(l,o[1])&&(l.textContent=o[1]),"--"===o[2]?i.setAttribute("data-status","1"):"++"===o[2]?i.setAttribute("data-status","2"):"**"===o[2]?i.setAttribute("data-status","3"):"<<"===o[2]&&a.add("redirect"),l=i.children[2],l.textContent=o[2],n.tabHostname&&i.setAttribute("data-tabhn",n.tabHostname),n.docHostname&&i.setAttribute("data-dochn",n.docHostname),l=i.children[3],l.textContent=o[3],""!==o[4]&&"network"===n.realm&&void 0!==n.domain){let t=`${n.tabDomain}`;n.docDomain!==n.tabDomain&&(t+=` ⋯ ${n.docDomain}`),t+=` ⇒ ${n.domain}`,i.setAttribute("data-parties",t)}return l=i.children[4],l.textContent=o[4],l=i.children[5],l.textContent=o[5],"static"===d?u=new RegExp(c.regex,"gi"):"dynamicUrl"===d&&(u=function(t){const e=t.indexOf(" "),n=t.indexOf(" ",e+1),o=t.slice(e+1,n);return"*"===o?new RegExp("^.*$","gi"):new RegExp("^"+o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")}(c.rule.join(" "))),function(t,e,n){const o=document.createDocumentFragment();if(void 0===n)o.textContent=e;else{"string"==typeof n&&(n=new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"));const t=n.exec(e);if(null===t||0===t[0].length)o.textContent=e;else{0!==t.index&&o.appendChild(document.createTextNode(e.slice(0,t.index)));const i=document.createElement("b");i.textContent=e.slice(t.index,n.lastIndex),o.appendChild(i),n.lastIndex!==e.length&&o.appendChild(document.createTextNode(e.slice(n.lastIndex)))}}if(/^https?:\/\//.test(e)){const t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank"),o.appendChild(t)}t.appendChild(o)}(i.children[6],o[6],u),o.length>7&&-1!==n.textContent.lastIndexOf("\taliasURL=")&&i.setAttribute("data-aliasid",n.id),i},v=function(){if(0===u)return;let t=-m%u;for(const e of a)e.div.style.top=`${t}px`,t+=u},x=function(t){let e=t-g,n=Math.abs(e);return n>0&&n<a.length&&(e<0?a.unshift(...a.splice(e)):a.push(...a.splice(0,e))),g=t,e},b=function(){let t=g;for(const e of a){const n=y(e,t),o=e.div,i=o.firstElementChild;null!==n?null===i?o.appendChild(n):n!==i&&(o.removeChild(i),o.appendChild(n)):null!==i&&o.removeChild(i),t+=1}},C=function(i){return function(e){g+=e;const o=Math.max(s.length*u,t.clientHeight);o!==p&&(n.style.height=`${o}px`,p=o)}(i),0===i?(0!==g&&g+a.length>s.length&&(g=s.length-a.length,g<0&&(g=0),m=g*u,o.style.top=`${m}px`,e.scrollTop=m,v()),void b()):0===m?(x(0),v(),void b()):(m+=u*i,o.style.top=`${m}px`,void(e.scrollTop=m))};return{updateContent:C,updateLayout:f}})(),L=(()=>{const t=vAPI.i18n("loggerCurrentTab");return function(){const e=uDom.nodeFromId("pageSelector");if("_"!==e.value||0===c)return;const n=e.querySelector('[value="_"]'),o=e.querySelector(`[value="${c}"]`);let i=t;null!==o&&(i+=" / "+o.textContent),n.textContent=i}})(),S=(()=>{let t;const n=async function(){if(void 0===e.ownerId)return;const n={what:"readAll",ownerId:e.ownerId,tabIdsToken:v};r instanceof Object&&(self.screenX!==r.x||self.screenY!==r.y||self.outerWidth!==r.w||self.outerHeight!==r.h)&&(r.x=self.screenX,r.y=self.screenY,r.w=self.outerWidth,r.h=self.outerHeight,n.popupLoggerBoxChanged=!0);const u=await vAPI.messaging.send("loggerUI",n);t=void 0,function(t){if(!t||t.unavailable)return;void 0===a&&void 0!==t.tooltips&&(a=t.tooltips,!1===a&&uDom("[data-i18n-title]").attr("title",""));let e=!1;t.activeTabId&&(e=t.activeTabId!==c,c=t.activeTabId),Array.isArray(t.tabIds)&&(t.tabIds=new Map(t.tabIds)),void 0!==t.tabIds&&(function(t){const e=uDom.nodeFromId("pageSelector"),n=e.value,o=x,r=new Set;for(const e of o.keys())t.has(e)||r.add(e);if(x=t,0!==r.size){const t="_"===n;let e=!1;for(let n=0,o=i.length;n<o;n++){const o=i[n];!1!==r.has(o.tabId)&&(o.voided||(e=o.voided=!0,t&&(o.dead=!0),i[n]=new w(o)))}e&&k.filterAll()}r.has($.tabId)&&$.toggleOff();const a=Array.from(t.keys()).sort((function(e,n){return t.get(e).localeCompare(t.get(n))}));let s=3;for(let o=0;o<a.length;o++){const i=a[o];if(i<=0)continue;s===e.options.length&&e.appendChild(document.createElement("option"));const r=e.options[s];r.textContent=t.get(i).slice(0,80),r.setAttribute("value",i),r.value===n?(e.selectedIndex=s,r.setAttribute("selected","")):r.removeAttribute("selected"),s+=1}for(;s<e.options.length;)e.removeChild(e.options[s]);e.value!==n&&(e.selectedIndex=0,e.value="",e.options[0].setAttribute("selected",""),D()),L()}(t.tabIds),v=t.tabIdsToken),d=!0===t.filterAuthorMode,e&&F(),function(t){const e=t.entries;if(0===e.length)return;const n="_"===uDom.nodeFromId("pageSelector").value,o=s.length;for(const t of e){const e=JSON.parse(t);if(e.filter instanceof Object&&R.processFilter(e.filter),p)continue;const o=E(e);if(void 0!==o.tabId&&!1===x.has(o.tabId)){if(n)continue;o.voided=!0}if("main_frame"===o.type&&!1===o.aliased&&(void 0===o.filter||"redirect"!==o.filter.source)){const t=I(o,e.url);i.unshift(t),k.filterOne(t)&&(s.unshift(t),t.voided&&(l+=1))}!1===m&&o.aliased&&(uDom.nodeFromId("filterExprCnameOf").style.display="",m=!0),i.unshift(o),k.filterOne(o)&&(s.unshift(o),o.voided&&(l+=1))}const r=s.length-o;0!==r&&(A.updateContent(r),P.inserted(r))}(t),document.body.classList.toggle("colorBlind",!0===t.colorBlind),uDom.nodeFromId("clean").classList.toggle("disabled",0===l),uDom.nodeFromId("clear").classList.toggle("disabled",0===s.length)}(u),o()},o=function(){void 0===t&&void 0!==e.ownerId&&(t=vAPI.setTimeout(n,1200))};return n(),o})(),D=function(){const t=uDom.nodeFromId("pageSelector");window.location.replace("#"+t.value),F()},F=(()=>{let t,e;return function(){let n=window.location.hash.slice(1),o=/^([^+]+)\+(.+)$/.exec(n);if(null!==o&&(n=o[1],c=parseInt(o[2],10)||0,window.location.hash="#"+n),n!==t){const e=uDom.nodeFromId("pageSelector");let o=e.querySelector('option[value="'+n+'"]');null===o&&(n="0",o=e.options[0]),e.selectedIndex=o.index,e.value=o.value,t=n}u="_"===n?c:parseInt(n,10)||0,e!==u&&(k.filterAll(),document.dispatchEvent(new Event("tabIdChanged")),L(),uDom(".needdom").toggleClass("disabled",u<=0),uDom(".needscope").toggleClass("disabled",u<=0),e=u)}})();(()=>{const e=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#]*)(\?[^#]*)?(#.*)?/,n=/^[\w-]+:$/,o={beacon:"ping",doc:"document",css:"stylesheet",frame:"subdocument",object_subrequest:"object"},r={};let a,s,l,c,u,p,m,g=null,f=null,v=[];const x=function(t){const e=C("select.type."+t);return"static"===t?o[e]||e:y[e]||e},b=function(t){return g.querySelector(t)},C=function(t){return b(t).value||""},w=function(){return g.querySelector("div.panes > div.static textarea")},I=async function(){!function(t){document.body.classList.toggle("dirty",t.dirty);for(const e in t.colors){if(!1===t.colors.hasOwnProperty(e))continue;const n=t.colors[e],o=g.querySelector('.dynamic .entry .action[data-url="'+e+'"]');null!==o&&(o.classList.toggle("allow",2===n.r),o.classList.toggle("noop",3===n.r),o.classList.toggle("block",1===n.r),o.classList.toggle("own",n.own))}}(await t.send("loggerUI",{what:"getURLFilteringData",context:C("select.dynamic.origin"),urls:v,type:x("dynamic")}))},E=function(){const t=[],e=""===C("select.static.action");let o="";e||(o="@@");let i=C("select.static.url");""!==i&&(n.test(i)?i=`|${i}`:(i.endsWith("/")?i+="*":!1===/[/?]/.test(i)&&(i+="^"),i=`||${i}`)),o+=i,i=C("select.static.type"),""!==i&&t.push(x("static")),i=C("select.static.origin"),""!==i&&(i===u?t.push("1p"):t.push("domain="+i)),e&&""!==C("select.static.importance")&&t.push("important"),t.length&&(o+="$"+t.join(",")),w().value=o,A()},A=function(){const t=w().value;g.querySelector("#createStaticFilter").classList.toggle("disabled",r.hasOwnProperty(t)||""===t)},L=function(t){const e=t.target.classList;e.contains("dynamic")?I():e.contains("static")&&E()},S=function(){A()},D=function(t,e){const n=t.length;if(n<=e)return t;const o=n-e-1,i=(n-o)/2|0;return t.slice(0,i)+"…"+t.slice(i+o)},F=function(){return f.children[1].textContent},k=async function(e,n){if(e.children[1].textContent=n,!0!==d)return;const o=/#@?#/.exec(n);if(null===o)return;const i=document.createDocumentFragment(),r=o.index+o[0].length;i.appendChild(document.createTextNode(n.slice(0,r)));const a=n.slice(r),s=document.createElement("span");s.className="filter",s.textContent=a,i.appendChild(s);const l=await t.send("loggerUI",{what:"hasTemporaryException",filter:n});e.classList.toggle("exceptored",l),("##"===o[0]||l)&&(e.children[2].style.visibility=""),e.children[1].textContent="",e.children[1].appendChild(i)},P=function(){const e=g.querySelectorAll(".pane.details > div"),n=f,o=n.classList,r=n.children;let a;a=F(),""!==a&&(o.contains("cosmeticRealm")||o.contains("networkRealm"))?k(e[0],a):e[0].style.display="none",""!==a&&(o.contains("dynamicHost")||o.contains("dynamicUrl")||o.contains("switch"))?e[2].children[1].textContent=a:e[2].style.display="none",o.contains("canLookup")?async function(e){const n=f.children[1].textContent,o=function(t){t instanceof Object==0&&(t={});let o="";for(const e in t)e.length>o.length&&(o=e);""!==o&&Array.isArray(t[o])&&(k(e[0],o),e[1].children[1].appendChild(function(t,e){const n=document.createDocumentFragment(),o=document.querySelector("#filterFinderListEntry > span");for(const t of e){const e=o.cloneNode(!0);let i=e.querySelector("a:nth-of-type(1)");i.href+=encodeURIComponent(t.assetKey),i.textContent=t.title,i=e.querySelector("a:nth-of-type(2)"),t.supportURL?i.setAttribute("href",t.supportURL):i.style.display="none",0!==n.childElementCount&&n.appendChild(document.createTextNode("\n")),n.appendChild(e)}return n}(0,t[o]))),0===e[1].children[1].childElementCount&&vAPI.i18n.safeTemplateToDOM("loggerStaticFilteringFinderSentence2",{filter:n},e[1].children[1])};f.classList.contains("networkRealm")?o(await t.send("loggerUI",{what:"listsFromNetFilter",rawFilter:n})):f.classList.contains("cosmeticRealm")&&o(await t.send("loggerUI",{what:"listsFromCosmeticFilter",url:f.children[6].textContent,rawFilter:n}))}(e):e[1].style.display="none";const s=n.getAttribute("data-tabhn")||"",l=n.getAttribute("data-dochn")||"";""!==s&&s!==l?e[3].children[1].textContent=s:e[3].style.display="none",""!==l?e[4].children[1].textContent=l:e[4].style.display="none",a=n.getAttribute("data-parties")||"",""!==a?e[5].children[1].textContent=`(${r[4].textContent}) ${a}`:e[5].style.display="none",a=r[5].textContent,""!==a?e[6].children[1].textContent=a:e[6].style.display="none";const c=r[6].textContent;if(""!==c){const t=n.getAttribute("data-status")||"";""!==t&&(e[7].setAttribute("data-status",t),n.hasAttribute("data-modifier")&&e[7].setAttribute("data-modifier","")),e[7].children[1].appendChild(r[6].cloneNode(!0))}else e[7].style.display="none";a=n.getAttribute("data-aliasid");const d=a?function(t){if(""===t)return"";for(const e of i)if(e.id===t&&!e.aliased)return e.textContent.split("\t")[6]||"";return""}(a):"";""!==d?(e[8].children[1].textContent=vAPI.hostnameFromURI(d)+" ⇒\n "+vAPI.hostnameFromURI(c),e[9].children[1].textContent=d):(e[8].style.display="none",e[9].style.display="none")},$=function(t,e,n){const o=vAPI.i18n("loggerStaticFilteringSentencePartOrigin");let i=e;for(;;){const e=document.createElement("option");if(e.setAttribute("value",i),e.textContent=o.replace("{{origin}}",i),t.appendChild(e),i===n)break;const r=i.indexOf(".");if(-1===r)break;i=i.slice(r+1)}},R=async function(o){if(f=o.target.closest(".canDetails"),null===f)return;o.stopPropagation(),c=function(t){const e=t.getAttribute("data-tabid")||"",n=parseInt(e,10);return isNaN(n)?0:n}(f),a=f.children[5].textContent.trim()||"",v=function(t){const n=e.exec(t);if(null===n)return[];if("string"!=typeof n[2]||0===n[2].length)return[n[1]];const o=[],i=n[1]+n[2];o.unshift(i);const r=n[3]||"";let a="/"===r.charAt(0)?1:0;for(;a<r.length;)a=r.indexOf("/",a),-1===a?a=r.length:a+=1,o.unshift(i+r.slice(0,a));const s=n[4]||"";return""!==s&&o.unshift(i+r+s),o}(f.children[6].textContent),l=f.getAttribute("data-tabhn")||"",s=f.getAttribute("data-dochn")||"";!function(e){g=h.create("#netFilteringDialog",(()=>{v=[],f=null,g=null})),g.classList.toggle("cosmeticRealm",f.classList.contains("cosmeticRealm")),u=e[0],p=e[1],m=e[2],function(t,e){const n="image"!==t||!1===f.classList.contains("networkRealm")||"1"===f.getAttribute("data-status");if(g.querySelector(".picker").classList.toggle("hide",c<0||n),n)return;const o=g.querySelector(".preview");o.querySelector("span").addEventListener("click",(()=>{const t=document.createElement("img");t.setAttribute("src",e),o.replaceChild(t,o.firstElementChild)}),{once:!0}),o.classList.remove("hide")}(a,v[0]),P(),function(){if(f.classList.contains("cosmeticRealm"))return;if("doc"===a)return;if(0===v.length||n.test(v[0]))return;let t=b("select.dynamic.origin");$(t,l,p);const e=document.createElement("option");e.textContent="*",e.setAttribute("value","*"),t.appendChild(e),t=b("select.dynamic.type"),t.options[0].textContent=a,t.options[0].setAttribute("value",a),t.selectedIndex=0;const o=g.querySelector(".dynamic .toolbar .entry"),i=g.querySelector(".dynamic .entries");for(const t of v){const e=o.cloneNode(!0);e.children[0].setAttribute("data-url",t),e.children[1].textContent=D(t,128),i.appendChild(e)}I(),uDom('#modalOverlayContainer [data-pane="dynamic"]').removeClass("hide")}(),function(){if(f.classList.contains("cosmeticRealm"))return;const t=vAPI.i18n("loggerStaticFilteringSentence"),e=/\{\{[^}]+?\}\}/g,n=[];let o=0;for(;;){const i=e.exec(t);if(null===i)break;let r,l;switch(o!==i.index&&n.push(document.createTextNode(t.slice(o,i.index))),o=e.lastIndex,i[0]){case"{{br}}":n.push(document.createElement("br"));break;case"{{action}}":r=document.createElement("select"),r.className="static action",l=document.createElement("option"),l.setAttribute("value",""),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartBlock"),r.appendChild(l),l=document.createElement("option"),l.setAttribute("value","@@"),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartAllow"),r.appendChild(l),n.push(r);break;case"{{type}}":r=document.createElement("select"),r.className="static type",l=document.createElement("option"),l.setAttribute("value",a),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartType").replace("{{type}}",a),r.appendChild(l),l=document.createElement("option"),l.setAttribute("value",""),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartAnyType"),r.appendChild(l),n.push(r);break;case"{{url}}":r=document.createElement("select"),r.className="static url";for(const t of v){const e=t.replace(/^[a-z-]+:\/\//,"");l=document.createElement("option"),l.setAttribute("value",e),l.textContent=D(e,128),r.appendChild(l)}n.push(r);break;case"{{origin}}":r=document.createElement("select"),r.className="static origin",$(r,s,m),l=document.createElement("option"),l.setAttribute("value",""),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartAnyOrigin"),r.appendChild(l),n.push(r);break;case"{{importance}}":r=document.createElement("select"),r.className="static importance",l=document.createElement("option"),l.setAttribute("value",""),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartNotImportant"),r.appendChild(l),l=document.createElement("option"),l.setAttribute("value","important"),l.textContent=vAPI.i18n("loggerStaticFilteringSentencePartImportant"),r.appendChild(l),n.push(r)}}o<t.length&&n.push(document.createTextNode(t.slice(o)));const i=g.querySelector("div.panes > .static > div:first-of-type");for(let t=0;t<n.length;t++)i.appendChild(n[t]);E()}(),g.addEventListener("click",(e=>{!async function(e){const n=e.target,o=n.classList;if(o.contains("header"))return e.stopPropagation(),void g.setAttribute("data-pane",n.getAttribute("data-pane"));if(o.contains("exceptor")){e.stopPropagation();const o=await t.send("loggerUI",{what:"toggleTemporaryException",filter:F()});return void n.closest("div").classList.toggle("exceptored",o)}if("createStaticFilter"===n.id){e.stopPropagation();const n=w().value;if(r.hasOwnProperty(n))return;return r[n]=!0,""!==n&&t.send("loggerUI",{what:"createUserFilter",autoComment:!0,filters:n,docURL:`https://${s}/`}),void A()}if("saveRules"===n.id)return e.stopPropagation(),await t.send("loggerUI",{what:"saveURLFilteringRules",context:C("select.dynamic.origin"),urls:v,type:x("dynamic")}),void I();const i=!!e.ctrlKey||!!e.metaKey;o.contains("action")?(e.stopPropagation(),await t.send("loggerUI",{what:"setURLFilteringRule",context:C("select.dynamic.origin"),url:n.getAttribute("data-url"),type:x("dynamic"),action:0,persist:i}),I()):o.contains("allow")?(e.stopPropagation(),await t.send("loggerUI",{what:"setURLFilteringRule",context:C("select.dynamic.origin"),url:n.parentNode.getAttribute("data-url"),type:x("dynamic"),action:2,persist:i}),I()):o.contains("noop")?(e.stopPropagation(),await t.send("loggerUI",{what:"setURLFilteringRule",context:C("select.dynamic.origin"),url:n.parentNode.getAttribute("data-url"),type:x("dynamic"),action:3,persist:i}),I()):o.contains("block")?(e.stopPropagation(),await t.send("loggerUI",{what:"setURLFilteringRule",context:C("select.dynamic.origin"),url:n.parentNode.getAttribute("data-url"),type:x("dynamic"),action:1,persist:i}),I()):o.contains("reload")?(e.stopPropagation(),t.send("loggerUI",{what:"reloadTab",tabId:c})):o.contains("picker")&&(e.stopPropagation(),t.send("loggerUI",{what:"launchElementPicker",tabId:c,targetURL:"img\t"+v[0],select:!0}))}(e)}),!0),g.addEventListener("change",L,!0),g.addEventListener("input",S,!0),h.show()}(await t.send("loggerUI",{what:"getDomainNames",targets:[v[0],l,s]}))};uDom("#netInspector").on("click",".canDetails > span:nth-of-type(2),.canDetails > span:nth-of-type(3),.canDetails > span:nth-of-type(5)",(t=>{R(t)}))})();const k=(()=>{const t=[],e=[];let n=!0,o=[];const r=function(){t.length=0;const n=uDom.nodeFromSelector("#filterInput > input").value.trim().split(/\s+/),i=n.length,r=[];let a=!1;for(let e=0;e<i;e++){let o=n[e];"!"===o.charAt(0)&&(0===r.length&&(a=!0),o=o.slice(1));let s="";if(o.startsWith("/")&&o.endsWith("/")){s=o.slice(1,-1);try{new RegExp(s)}catch(t){s=""}}if(""===s){const t=o.startsWith("|");t&&(o=o.slice(1));const e=o.endsWith("|");e&&(o=o.slice(0,-1)),s=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t&&(s=""!==s?"(?:^|\\s|\\|)"+s:"\\|"),e&&(s+="(?:\\||\\s|$)")}""!==s&&(r.push(s),e<i-1&&"||"===n[e+1]?e+=1:(s=1===r.length?r[0]:r.join("|"),t.push({re:new RegExp(s,"i"),r:!a}),r.length=0,a=!1))}o=e.concat(t)},a=function(t){if(t.dead||0!==u&&(void 0===t.tabId||t.tabId>0&&t.tabId!==u))return!1;if(!1===n||0===o.length)return!0;if("tabLoad"===t.type)return!0;for(const e of o)if(e.re.test(t.textContent)!==e.r)return!1;return!0},c=function(){s=[],l=0;for(const t of i)!1!==a(t)&&(s.push(t),t.voided&&(l+=1));A.updateContent(0),uDom.nodeFromId("filterButton").classList.toggle("active",0!==o.length),uDom.nodeFromId("clean").classList.toggle("disabled",0===l),uDom.nodeFromId("clear").classList.toggle("disabled",0===s.length)},d=(()=>{let t;const e=()=>{t=void 0,r(),c()};return()=>{void 0!==t&&clearTimeout(t),t=vAPI.setTimeout(e,750)}})();return uDom("#filterButton").on("click",(function(){n=!n,uDom.nodeFromId("netInspector").classList.toggle("f",n),c()})),uDom("#filterInput > input").on("input",d),uDom("#filterExprButton").on("click",(function(t){t.target.classList.toggle("expanded")})),uDom("#filterExprPicker").on("click","[data-filtex]",(function(n){e.length=0,n.target.classList.toggle("on");const i=n.currentTarget.querySelectorAll("[data-filtex]"),r=[];let a=!1;for(const t of i){let n=t.getAttribute("data-filtex"),o=t.classList.contains("on");"!"===n?(0!==r.length&&(e.push({re:new RegExp(r.join("|")),r:!a}),r.length=0),a=o):o&&r.push(n)}0!==r.length&&e.push({re:new RegExp(r.join("|")),r:!a}),o=e.concat(t),uDom.nodeFromId("filterExprButton").classList.toggle("active",0!==e.length),c()})),r(),c(),{filterOne:a,filterAll:c}})(),P=(()=>{const t=new Set,e=new Map,n=new Map;let o=0;const r=function(){setTimeout((()=>{self.requestIdleCallback((a=>{!function(r){const a=q.discard,s="number"==typeof a.maxLoadCount?a.maxLoadCount:0,l="number"==typeof a.maxEntryCount?a.maxEntryCount:0,c="number"==typeof a.maxAge?Date.now()-6e4*a.maxAge:0,d=Date.now()+Math.ceil(r);let u=o;u>=i.length&&(u=0),0===u&&(t.clear(),e.clear(),n.clear());let p=-1,m=0,g=0,h=!1;for(;u<i.length&&!(u%64==0&&Date.now()>=d);){const o=i[u],r=o.tabId||0;if(o.dead||t.has(r))-1===p&&(p=u),u+=1;else{if(0!==s&&"tabLoad"===o.type){let n=(e.get(r)||0)+1;e.set(r,n),n>=s&&t.add(r)}if(0!==l&&(m!==r&&(0!==g&&n.set(m,g),m=r,g=n.get(r)||0),g+=1,g>=l&&t.add(m)),0!==c&&o.tstamp<=c){-1===p&&(p=u);break}-1!==p&&(i.copyWithin(p,u),i.length-=u-p,p=-1,h=!0),u+=1}}-1!==p&&(i.length=p,h=!0),u>=i.length&&(u=0),o=u,0===o&&(t.clear(),e.clear(),n.clear()),!1!==h&&k.filterAll()}(a.timeRemaining()),r()}))}),1889)};return r(),uDom.nodeFromId("clean").addEventListener("click",(function(){if(0===s.length)return;let t=0,e=s[0];for(const n of i)if(n===e){if(n.voided&&(n.dead=!0),t+=1,t===s.length)break;e=s[t]}k.filterAll()})),uDom.nodeFromId("clear").addEventListener("click",(function(){if(0===s.length)return;let t=!0;if(0!==u)for(const e of s)if(e.tabId===u){t=!1;break}let e=0,n=s[0];for(const o of i)if(o===n){if((o.tabId===u||t)&&(o.dead=!0),e+=1,e===s.length)break;n=s[e]}k.filterAll()})),{inserted:function(t){0!==o&&(o+=t)}}})(),$=(()=>{let t=0,e=null,n=null;const o=function(){if(null===e)return;const t=e.contentWindow.document.body;0!==t.clientWidth&&e.clientWidth!==t.clientWidth&&e.style.setProperty("width",t.clientWidth+"px"),0!==t.clientHeight&&e.clientHeight!==t.clientHeight&&e.style.setProperty("height",t.clientHeight+"px")},i=function(){o(),n.observe(e.contentDocument.body,{subtree:!0,attributes:!0})},r=function(t){null!==e&&e.setAttribute("src","popup-fenix.html?portrait=1&tabId="+t)},a=function(){const e=g();if(0===e)return s();t=e,r(t)},s=function(){uDom.nodeFromId("showpopup").classList.remove("active"),document.removeEventListener("tabIdChanged",a),uDom.nodeFromId("inspectors").classList.remove("popupOn"),e.removeEventListener("load",i),n.disconnect(),n=null,e.setAttribute("src",""),t=0},l={get tabId(){return t||0},toggleOff:function(){0!==t&&s()}};return uDom.nodeFromId("showpopup").addEventListener("click",(()=>{0===t?function(){const s=g();if(0===s)return;t=s,e=uDom.nodeFromId("popupContainer"),e.addEventListener("load",i),n=new MutationObserver(o);const l=uDom.nodeFromId("inspectors"),c=l.getBoundingClientRect();e.style.setProperty("right",c.right-l.clientWidth+"px"),l.classList.add("popupOn"),document.addEventListener("tabIdChanged",a),r(t),uDom.nodeFromId("showpopup").classList.add("active")}():s()})),l})(),R=(()=>{const t=new Map;let e,n;const o=function(){const t=document.createElement("div");return t.appendChild(document.createElement("span")),t.appendChild(document.createElement("span")),t},i=function(t,e){t.children[0].textContent=e[1].toLocaleString(),t.children[1].textContent=e[0]},r=function(){const n=Array.from(t).sort(((t,e)=>e[1]-t[1])),r=document,a=e.querySelector(".sortedEntries");let s=0;for(let t=0;t<a.childElementCount&&s!==n.length;t++)i(a.children[t],n[s]),s+=1;if(s<n.length){const t=r.createDocumentFragment();for(;s<n.length;s++){const e=o();i(e,n[s]),t.appendChild(e)}a.appendChild(t)}};return uDom.nodeFromId("loggerStats").addEventListener("click",(function(){e=h.create("#loggerStatsDialog",(()=>{e=void 0,void 0!==n&&(self.cancelIdleCallback(n),n=void 0)})),r(),h.show()})),{processFilter:function(o){"static"!==o.source&&"cosmetic"!==o.source||(t.set(o.raw,(t.get(o.raw)||0)+1),void 0!==e&&void 0===n&&(n=self.requestIdleCallback((()=>{n=void 0,r()}),{timeout:2001})))}}})();(()=>{const t=[],e={format:"list",encoding:"markdown",time:"anonymous"};let n;const o=function(){const o=n.querySelector(".output");"list"===e.format?o.textContent=function(){const n=[];for(const e of t){const t=[];for(let n=0;n<e.length;n++){let o=e[n];0!==o.length&&t.push(o)}n.push(t.join("\n"))}let o,i,r;if("markdown"===e.encoding){const t="```";o=`<details><summary>Logger output</summary>\n\n${t}\n`,i=`\n${t}\n${t}\n`,r=`\n${t}\n</details>\n`}else o="",i="\n\n",r="\n";return`${o}${n.join(i)}${r}`}():o.textContent="plain"===e.encoding?function(){const e=[];for(const n of t)e.push(n.join("\t"));return e.push(""),e.join("\n")}():function(){const e=[];let n=0;for(const o of t){if(o.length<=2)continue;o.length>n&&(n=o.length);const t=[];for(let e=0;e<o.length;e++){const n=o[e];let i=/\b(?:www\.|https?:\/\/)/.test(n)?"`":"";t.push(` ${i}${n.replace(/\|/g,"\\|")}${i} `)}e.push(t.join("|"))}return 0!==n&&e.unshift(`${" |".repeat(n-1)} `,`${":--- |".repeat(n-1)}:--- `),`<details><summary>Logger output</summary>\n\n|${e.join("|\n|")}|\n</details>\n`}()},i=function(t,o){if(!1===e.hasOwnProperty(t))return;const i=n.querySelector(`[data-radio="${t}"]`).querySelectorAll("[data-radio-item]");for(const t of i)t.classList.toggle("on",t.getAttribute("data-radio-item")===o);e[t]=o},r=function(t){const e=t.target.closest("span[data-i18n]");if(null===e)return;if(e.matches(".pushbutton")){const e=n.querySelector("textarea");return e.focus(),e.selectionEnd===e.selectionStart&&e.select(),document.execCommand("copy"),void t.stopPropagation()}const r=e.closest("[data-radio]");if(null===r)return;if(e.matches("span.on"))return;const a=e.closest("[data-radio-item]");null!==a&&(i(r.getAttribute("data-radio"),a.getAttribute("data-radio-item")),o(),t.stopPropagation())};uDom.nodeFromId("loggerExport").addEventListener("click",(function(){n=h.create("#loggerExportDialog",(()=>{n=void 0,t.length=0})),i("format",e.format),i("encoding",e.encoding),function(){t.length=0;let n=0!==s.length?s[s.length-1].tstamp:0;for(const o of s){const i=o.textContent,r=[];let a=0,s=i.indexOf("\t");if(0===s)continue;let l=i.slice(0,s);for("anonymous"===e.time&&(l="+"+Math.round((o.tstamp-n)/1e3).toString()),r.push(l),s+=1;s<i.length;){let t=i.indexOf("\t",s);-1===t&&(t=i.length),r.push(i.slice(s,t)),s=t+1,a+=1}t.push(r)}}(),o(),n.querySelector(".options").addEventListener("click",r,{capture:!0}),h.show()}))})();const q=(()=>{const t={discard:{maxAge:240,maxEntryCount:2e3,maxLoadCount:20},columns:[!0,!0,!0,!0,!0,!0,!0,!0],linesPerEntry:4};vAPI.localStorage.getItemAsync("loggerSettings").then((e=>{try{const n=JSON.parse(e);"number"==typeof n.discard.maxAge&&(t.discard.maxAge=n.discard.maxAge),"number"==typeof n.discard.maxEntryCount&&(t.discard.maxEntryCount=n.discard.maxEntryCount),"number"==typeof n.discard.maxLoadCount&&(t.discard.maxLoadCount=n.discard.maxLoadCount),"number"==typeof n.linesPerEntry&&(t.linesPerEntry=n.linesPerEntry),Array.isArray(n.columns)&&(t.columns=n.columns)}catch(t){}}));const e=function(t,e){let n=parseInt(t.value,10);isNaN(n)&&(n=e);const o=parseInt(t.getAttribute("min"),10);!1===isNaN(o)&&(n=Math.max(n,o));const i=parseInt(t.getAttribute("max"),10);return!1===isNaN(i)&&(n=Math.min(n,i)),n};return uDom.nodeFromId("loggerSettings").addEventListener("click",(function(){const n=h.create("#loggerSettingsDialog",(n=>{!function(n){let o=n.querySelectorAll('input[type="number"]');t.discard.maxAge=e(o[0],240),t.discard.maxLoadCount=e(o[1],25),t.discard.maxEntryCount=e(o[2],2e3),t.linesPerEntry=e(o[3],4),o=n.querySelectorAll('input[type="checkbox"][data-column]');for(const e of o){const n=parseInt(e.getAttribute("data-column"),10);t.columns[n]=!0!==e.checked}vAPI.localStorage.setItem("loggerSettings",JSON.stringify(t)),A.updateLayout()}(n)}));let o=n.querySelectorAll('input[type="number"]');o[0].value=t.discard.maxAge,o[1].value=t.discard.maxLoadCount,o[2].value=t.discard.maxEntryCount,o[3].value=t.linesPerEntry,o[3].addEventListener("input",(n=>{t.linesPerEntry=e(n.target,4),A.updateLayout()}));const i=e=>{const n=e.target,o=parseInt(n.getAttribute("data-column"),10);t.columns[o]=!0!==n.checked,A.updateLayout()};o=n.querySelectorAll('input[type="checkbox"][data-column]');for(const e of o){const n=parseInt(e.getAttribute("data-column"),10);e.checked=!1===t.columns[n],e.addEventListener("change",i)}h.show()})),t})();e.resize=function(){let t;const e=function(){void 0===t&&(t=self.requestAnimationFrame((()=>{t=void 0,function(){const t=document.body.getBoundingClientRect(),e=document.querySelectorAll(".vscrollable");for(const n of e){const e=n.getBoundingClientRect(),o=e.bottom-t.bottom;0!==o&&(n.style.height=Math.ceil(e.height-o)+"px")}}()})))};return e(),window.addEventListener("resize",e,{passive:!0}),e}();const T=function(){void 0!==e.ownerId&&(vAPI.messaging.send("loggerUI",{what:"releaseView",ownerId:e.ownerId}),e.ownerId=void 0)};window.addEventListener("pagehide",T),window.addEventListener("pageshow",(function(){void 0===e.ownerId&&(e.ownerId=Date.now()),S()})),window.addEventListener("beforeunload",T),uDom("#pageSelector").on("change",D),uDom("#refresh").on("click",(function(e){const n=g();n<=0||t.send("loggerUI",{what:"reloadTab",tabId:n,bypassCache:e&&(e.ctrlKey||e.metaKey||e.shiftKey)})})),uDom("#netInspector .vCompactToggler").on("click",(function(){uDom.nodeFromSelector("#netInspector .vCompactToggler").classList.toggle("vExpanded"),A.updateLayout()})),uDom("#pause").on("click",(function(){p=uDom.nodeFromId("netInspector").classList.toggle("paused")})),F(),window.addEventListener("hashchange",F),self.location.search.includes("popup=1")&&window.addEventListener("load",(()=>{setTimeout((()=>{r={x:self.screenX,y:self.screenY,w:self.outerWidth,h:self.outerHeight}}),2e3)}),{once:!0})})();