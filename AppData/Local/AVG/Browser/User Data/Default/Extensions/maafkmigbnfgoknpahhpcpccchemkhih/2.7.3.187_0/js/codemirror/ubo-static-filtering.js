"use strict";{const e=new Map,t=new Map,n=new Map,i=[],r=[];let s=!1;CodeMirror.defineMode("ubo-static-filtering",(function(){const c="object"==typeof vAPI?vAPI.StaticFilteringParser:self.StaticFilteringParser;if(c instanceof Object==0)return;const l=new c({interactive:!0}),a=/\bhttps?:\/\/\S+/,f=/^!#(?:if|endif|include )\b/,u=/^(!#if ?)(.*)$/;let p=0,h=!1;const d=function(i){if(l.category===l.CATNone||l.shouldIgnore())return i.skipToEnd(),"comment";if(l.category===l.CATComment)return function(e){const{string:t,pos:i}=e;if(!1===f.test(t)){const n=a.exec(t.slice(i));return null!==n?0===n.index?(e.pos+=n[0].length,"comment link"):(e.pos+=n.index,"comment"):(e.skipToEnd(),"comment")}const r=u.exec(t);if(null===r)return e.skipToEnd(),"variable strong";if(i<r[1].length)return e.pos+=r[1].length,"variable strong";if(e.skipToEnd(),!1===r[1].endsWith(" "))return"error strong";if(0===n.size)return"positive strong";let s=r[2];const o=s.startsWith("!");return o&&(s=s.slice(1)),!1===n.has(s)?"error strong":o!==n.get(s)?"positive strong":"negative strong"}(i);if(0!=(l.slices[p]&l.BITError))return i.pos+=l.slices[p+2],p+=3,"error";if(0!=(l.slices[p]&l.BITIgnore))return i.pos+=l.slices[p+2],p+=3,"comment";if(l.category===l.CATStaticExtFilter){const e=function(e){if(p<l.optionsAnchorSpan.i){const t=0==(l.slices[p]&l.BITComma)?"value":"def";return e.pos+=l.slices[p+2],p+=3,t}if(p>=l.optionsAnchorSpan.i&&p<l.patternSpan.i){const t=0!=(l.flavorBits&l.BITFlavorException)?"tag":"def";return e.pos+=l.slices[p+2],p+=3,`${t} strong`}return p>=l.patternSpan.i&&p<l.rightSpaceSpan.i?function(e){return 0!=(l.flavorBits&l.BITFlavorExtScriptlet)?function(e){const{pos:n,string:i}=e,{i:r,len:s}=l.patternSpan,o=l.slices[r+1];if(n===o)return e.pos=n+4,"def";if(s>3){if(n===o+4){const r=/^[^,)]+/.exec(i.slice(n)),s=r&&r[0].trim();if(s&&!1===t.has(s))return e.pos=n+r[0].length,"warning"}const c=l.slices[r+s+1]-1;if(n<c)return e.pos=c,"variable";if(n===c)return e.pos=n+1,"def"}return e.skipToEnd(),"variable"}(e):0!=(l.flavorBits&l.BITFlavorExtHTML)?function(e){const{i:t}=l.patternSpan;return e.pos===l.slices[t+1]?(e.pos+=1,"def"):(e.skipToEnd(),"variable")}(e):(e.skipToEnd(),"variable")}(e):(e.skipToEnd(),null)}(i)||"";let n="";return 0!=(l.flavorBits&l.BITFlavorExtCosmetic)?n="line-cm-ext-dom":0!=(l.flavorBits&l.BITFlavorExtScriptlet)?n="line-cm-ext-js":0!=(l.flavorBits&l.BITFlavorExtHTML)&&(n="line-cm-ext-html"),`${n} ${e}`.trim()}if(l.category===l.CATStaticNetFilter){const t=function(t){if(p<l.exceptionSpan.i)return t.pos+=l.slices[p+2],p+=3,null;if(p===l.exceptionSpan.i&&0!==l.exceptionSpan.len)return t.pos+=l.slices[p+2],p+=3,"tag strong";if(p===l.patternLeftAnchorSpan.i&&0!==l.patternLeftAnchorSpan.len||p===l.patternRightAnchorSpan.i&&0!==l.patternRightAnchorSpan.len)return t.pos+=l.slices[p+2],p+=3,"keyword strong";if(p>=l.patternSpan.i&&p<l.optionsAnchorSpan.i){if(l.patternIsRegex())return t.pos=l.slices[l.optionsAnchorSpan.i+1],p=l.optionsAnchorSpan.i,l.patternIsTokenizable()?"variable notice":"variable warning";if(0!=(l.slices[p]&(l.BITAsterisk|l.BITCaret)))return t.pos+=l.slices[p+2],p+=3,"keyword strong";const e=l.skipUntil(p+3,l.patternRightAnchorSpan.i,l.BITAsterisk|l.BITCaret);return t.pos=l.slices[e+1],p=e,"variable"}return p===l.optionsAnchorSpan.i&&p<l.optionsSpan.i!==0?(t.pos+=l.slices[p+2],p+=3,"def strong"):p>=l.optionsSpan.i&&p<l.commentSpan.i?function(t){const n=l.slices[p];return 0!=(n&l.BITComma)?(h=!1,t.pos+=l.slices[p+2],p+=3,"def strong"):h?function(t,n){const{pos:i,string:r}=t;let s;if(61===r.charCodeAt(i-1)&&/[$,](redirect(-rule)?|rewrite)=$/.test(r.slice(0,i))){s="value";const n=l.skipUntil(p,l.commentSpan.i,l.BITComma),i=l.strFromSlices(p,n-3),{token:r}=c.parseRedirectValue(i);return!1===e.has(r)&&(s+=" warning"),t.pos+=i.length,p=n,s}return 0!=(n&l.BITTilde)?s="keyword strong":0!=(n&l.BITPipe)&&(s="def"),t.pos+=l.slices[p+2],p+=3,s||"value"}(t,n):0!=(n&l.BITTilde)?(t.pos+=l.slices[p+2],p+=3,"keyword strong"):0!=(n&l.BITEqual)?(h=!0,t.pos+=l.slices[p+2],p+=3,"def"):(p=l.skipUntil(p,l.commentSpan.i,l.BITComma|l.BITEqual),t.pos=l.slices[p+1],"def")}(t):p>=l.commentSpan.i&&0!==l.commentSpan.len?(t.skipToEnd(),"comment"):(t.skipToEnd(),null)}(i);return t?`line-cm-net ${t}`:"line-cm-net"}return i.skipToEnd(),null};return{lineComment:"!",token:function(e){let t="";return e.sol()&&(l.analyze(e.string),l.analyzeExtra(),p=0,h=!1),t+=d(e)||"",0!=(l.flavorBits&l.BITFlavorError)&&(t+=" line-background-error"),t=t.trim(),""!==t?t:null},setHints:function(c){if(Array.isArray(c.redirectResources))for(const[n,i]of c.redirectResources){const r=""!==i.aliasOf?`${n} (${i.aliasOf})`:"";i.canRedirect&&e.set(n,r),i.canInject&&n.endsWith(".js")&&t.set(n.slice(0,-3),r)}if(Array.isArray(c.preparseDirectiveTokens)&&c.preparseDirectiveTokens.forEach((([e,t])=>{n.set(e,t)})),Array.isArray(c.preparseDirectiveHints)&&i.push(...c.preparseDirectiveHints),Array.isArray(c.originHints)){r.length=0;for(const e of c.originHints)r.push(e)}!1===s&&(s=!0,o())},get parser(){return l}}}));const o=function(){const n="object"==typeof vAPI?vAPI.StaticFilteringParser:self.StaticFilteringParser;if(n instanceof Object==0)return;const s=new n,o=new Map(Array.from(s.proceduralOperatorTokens).filter((e=>0!=(1&e[1])))),c=new Set(["genericblock","object-subrequest","rewrite","webrtc"]),l=function(e,t,n,i){const r=(t+n).trim(),s=[];for(const e of i)!1!==(e instanceof Object?e.displayText||e.text:e).startsWith(r)&&s.push(e);if(0===s.length)for(const e of i){const n=e instanceof Object?e.displayText||e.text:e;if(1===t.length){if(!1===n.startsWith(t))continue}else if(!1===n.includes(r))continue;s.push(e)}return{from:{line:e.line,ch:e.ch-t.length},to:{line:e.line,ch:e.ch+n.length},list:s}},a=function(e,t,n=""){const i=e.ch,s=/[^,|=~]*$/.exec(t.slice(0,i)),o=/^[^#,|]*/.exec(t.slice(i));if(null===s||null===o)return;const c=[];for(const e of r)c.push(e+n);return l(e,s[0],o[0],c)};CodeMirror.registerHelper("hint","ubo-static-filtering",(function(n){const r=n.getCursor(),f=n.getLine(r.line);if(s.analyze(f),s.category===s.CATStaticExtFilter){let e;return e=r.ch<=s.slices[s.optionsAnchorSpan.i+1]?a(r,f):s.hasFlavor(s.BITFlavorExtScriptlet)?function(e,n){const i=e.ch,r=/#\+\js\(([^,]*)$/.exec(n.slice(0,i)),s=/^([^,)]*)/.exec(n.slice(i));if(null===r||null===s)return;const o=[];for(const[e,n]of t){const t={text:e};""!==n&&(t.displayText=n),o.push(t)}return l(e,r[1],s[1],o)}(r,f):function(e,t){const n=e.ch,i=/#\^?.*:([^:]*)$/.exec(t.slice(0,n)),r=/^([a-z-]*)\(?/.exec(t.slice(n));if(null===i||null===r)return;const s=-1!==i[0].indexOf("^"),c=[];for(let[e,t]of o)s&&0!=(2&t)||c.push(e);return l(e,i[1],r[1],c)}(r,f),e}return s.category===s.CATStaticNetFilter?function(t,n){const i=t.ch;if(i<=s.slices[s.optionsAnchorSpan.i+1])return function(e,t){return/\|\|[\w.-]*$/.test(t.slice(0,e.ch))?a(e,t,"^"):!1===/[^\w\x80-\xF4#,.-]/.test(t)?a(e,t):void 0}(t,n);const r=n.slice(0,i),o=n.slice(i);let f=/[^$,]*$/.exec(r),u=/^[^,]*/.exec(o);if(null===f||null===u)return;const p=f[0].indexOf("=");return-1===p?function(e,t,n){const i=t.startsWith("~");i&&(t=t.slice(1));const r=n.indexOf("=");-1!==r&&(n=n.slice(0,r));const o=s.isException(),a=[];for(let[e,t]of s.netOptionTokenDescriptors)if(!(c.has(e)||i&&0==(t&s.OPTCanNegate))){if(o){if(0!=(t&s.OPTBlockOnly))continue}else{if(0!=(t&s.OPTAllowOnly))continue;-1===r&&0!=(t&s.OPTMustAssign)&&(e+="=")}a.push(e)}return l(e,t,n,a)}(t,f[0],u[0]):/^(redirect(-rule)?|rewrite)=/.test(f[0])?function(t,n,i){const r=[];for(const t of e.keys())t.startsWith("abp-resource:")||r.push(t);return l(t,n,i,r)}(t,f[0].slice(p+1),u[0]):f[0].startsWith("domain=")?a(t,n):void 0}(r,f):s.category===s.CATComment?function(e,t){const n=e.ch;if(t.startsWith("!#if ")){const r=/^!#if !?(\w*)$/.exec(t.slice(0,n)),s=/^\w*/.exec(t.slice(n));if(null===r||null===s)return;return l(e,r[1],s[0],i)}if(t.startsWith("!#")&&"!#endif"!==t){const i=/^!#(\w*)$/.exec(t.slice(0,n)),r=/^\w*/.exec(t.slice(n));if(null===i||null===r)return;const s=["if ","endif\n","include "];return l(e,i[1],r[0],s)}}(r,f):s.category===s.CATNone?a(r,f):void 0}))};CodeMirror.registerHelper("fold","ubo-static-filtering",(function(e,t){const n=t.line,i=e.getLine(n);return i.startsWith("!#if")?function(e,t,n){const i=n.lastLine();let r=e,s=1;for(;r<i;){r+=1;const i=n.getLine(r);if(i.startsWith("!#endif")&&(s-=1,0===s))return{from:CodeMirror.Pos(e,t.length),to:CodeMirror.Pos(r,0)};i.startsWith("!#if")&&(s+=1)}}(n,i,e):i.startsWith("!#include ")?function(e,t,n){const i=n.lastLine();let r=e+1;if(!(r>=i)&&!1!==n.getLine(r).startsWith("! >>>>>>>> "))for(;r<i;){r+=1;const i=n.getLine(r);if(i.startsWith("! <<<<<<<< "))return{from:CodeMirror.Pos(e,t.length),to:CodeMirror.Pos(r,i.length)}}}(n,i,e):void 0}));{const e=function(e,t){const{line:n,ch:i}=t,r=e.getLine(n),{type:s}=e.getTokenAt(t);let o,c;if(/\bcomment\b/.test(s)&&/\blink\b/.test(s)){const e=/\S+$/.exec(r.slice(0,i));if(e&&/^https?:\/\//.test(r.slice(e.index))){const t=/^\S+/.exec(r.slice(i));t&&(o=e.index,c=i+t[0].length)}}else if(/\bline-cm-ext-(?:dom|html|js)\b/.test(s)&&/\bvalue\b/.test(s)){const e=/[^,.]*$/i.exec(r.slice(0,i)),t=/^[^#,]*/i.exec(r.slice(i));e&&t&&(o=e.index,c=i+t[0].length)}else if(/\bline-cm-ext-(?:dom|html)\b/.test(s)){const t=/[#.]?[a-z0-9_-]+$/i.exec(r.slice(0,i)),s=/^[a-z0-9_-]+/i.exec(r.slice(i));t&&s&&(o=t.index,c=i+s[0].length,/\bdef\b/.test(e.getTokenTypeAt({line:n,ch:o+1}))&&(o+=1))}else if(/\bline-cm-net\b/.test(s))if(/\bvalue\b/.test(s)){const e=/[^ ,.=|]*$/i.exec(r.slice(0,i)),t=/^[^ #,|]*/i.exec(r.slice(i));e&&t&&(o=e.index,c=i+t[0].length)}else if(/\bdef\b/.test(s)){const e=/[a-z0-9-]+$/i.exec(r.slice(0,i)),t=/^[^,]*=[^,]+/i.exec(r.slice(i));e&&t&&(o=e.index,c=i+t[0].length)}if(void 0===o){const{anchor:n,head:i}=e.findWordAt(t);return{from:n,to:i}}return{from:{line:n,ch:o},to:{line:n,ch:c}}};CodeMirror.defineInitHook((t=>{t.setOption("configureMouse",(function(t,n){return{unit:"double"===n?e:null}}))}))}}