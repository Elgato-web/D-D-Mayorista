"use strict";(()=>{const e=new Map([["alt","Alt"],["control","Ctrl"]]),t=new Map([["a","A"],["b","B"],["c","C"],["d","D"],["e","E"],["f","F"],["g","G"],["h","H"],["i","I"],["j","J"],["k","K"],["l","L"],["m","M"],["n","N"],["o","O"],["p","P"],["q","Q"],["r","R"],["s","S"],["t","T"],["u","U"],["v","V"],["w","W"],["x","X"],["y","Y"],["z","Z"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["f1","F1"],["f2","F2"],["f3","F3"],["f4","F4"],["f5","F5"],["f6","F6"],["f7","F7"],["f8","F8"],["f9","F9"],["f10","F10"],["f11","F11"],["f12","F12"],[" ","Space"],[",","Comma"],[".","Period"],["home","Home"],["end","End"],["pageup","PageUp"],["pagedown","PageDown"],["insert","Insert"],["delete","Delete"],["arrowup","Up"],["arrowdown","Down"],["arrowleft","Left"],["arrowright","Right"],["shift","Shift"]]),n=function(e){for(;null!==e;){const t=e.getAttribute("data-name");if("string"==typeof t&&""!==t)return t;e=e.parentElement}},o=function(o){const r=o.target,a=n(r);if(void 0===a)return;const i=r.value,d=new Set;let s=0;const u=function(){return r.value=Array.from(d).join("+")},c=function(){r.removeEventListener("blur",c,!0),r.removeEventListener("keydown",f,!0),r.removeEventListener("keyup",l,!0),2===s?vAPI.messaging.send("dashboard",{what:"setShortcut",name:a,shortcut:u()}):r.value=i},f=function(n){if(n.preventDefault(),n.stopImmediatePropagation(),"Escape"!==n.code)if(0!==s){if(1===s){if("Shift"===n.key)return d.add("Shift"),void u();let e=t.get(n.key.toLowerCase());if(void 0!==e)return d.add(e),u(),s=2,void r.blur()}}else{const t=e.get(n.key.toLowerCase());void 0!==t&&(d.add(t),u(),s=1)}else r.blur()},l=function(t){if(t.preventDefault(),t.stopImmediatePropagation(),1!==s)return;const n=e.get(t.key.toLowerCase());return void 0!==n&&d.has(n)?(d.clear(),u(),void(s=0)):"Shift"===t.key?(d.delete("Shift"),void u()):void 0};r.value="",r.addEventListener("blur",c,!0),r.addEventListener("keydown",f,!0),r.addEventListener("keyup",l,!0)},r=function(e){const t=n(e.target);if(void 0===t)return;const o=document.querySelector('[data-name="'+t+'"] input');null!==o&&(o.value="",vAPI.messaging.send("dashboard",{what:"setShortcut",name:t}))};vAPI.messaging.send("dashboard",{what:"getShortcuts"}).then((e=>{!function(e){if(!1===Array.isArray(e))return;const t=document.querySelector("#templates .commandEntry"),n=document.querySelector(".commandEntries tbody");for(const a of e){if("string"!=typeof a.description||""===a.description)continue;const e=t.cloneNode(!0);e.setAttribute("data-name",a.name),e.querySelector(".commandDesc").textContent=a.description;const i=e.querySelector(".commandShortcut input");i.setAttribute("data-name",a.name),i.value=a.shortcut,i.addEventListener("focus",o),e.querySelector(".commandReset").addEventListener("click",r),n.appendChild(e)}}(e)}))})();