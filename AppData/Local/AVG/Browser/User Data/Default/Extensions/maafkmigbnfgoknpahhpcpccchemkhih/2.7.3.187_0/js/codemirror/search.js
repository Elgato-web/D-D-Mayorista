"use strict";!function(e){const t=function(t,n){const r=e.keyName(n);r&&e.lookupKey(r,t.getOption("keyMap"),(function(e){c(t,e)&&(n.preventDefault(),n.stopPropagation())}))},n=function(e){let t=l(e);o(e)!==t.queryText&&(null!==t.queryTimer&&clearTimeout(t.queryTimer),t.queryTimer=setTimeout((()=>{t.queryTimer=null,m(e,0)}),350))},r=function(e,t){const n=t.target.classList;n.contains("cm-search-widget-up")?h(e,-1):n.contains("cm-search-widget-down")&&h(e,1),"input"!==t.target.localName?t.preventDefault():t.stopImmediatePropagation()},o=function(e){return l(e).widget.querySelector('input[type="search"]').value},i=function(e,t){const n=l(e).widget.querySelector('input[type="search"]');"string"==typeof t&&t!==n.value&&(n.value=t),n.setSelectionRange(0,n.value.length),n.focus()},a=function(e){this.query=null,this.panel=null;const o=document.querySelector(".cm-search-widget-template").cloneNode(!0);this.widget=o.children[0],this.widget.addEventListener("keydown",t.bind(null,e)),this.widget.addEventListener("input",n.bind(null,e)),this.widget.addEventListener("mousedown",r.bind(null,e)),"function"==typeof e.addPanel&&(this.panel=e.addPanel(this.widget)),this.queryText="",this.queryTimer=null,this.dirty=!0,this.lines=[],e.on("changes",((e,t)=>{for(const e of t)if(0!==e.text.length||0!==e.removed){this.dirty=!0;break}})),e.on("cursorActivity",(e=>{y(e)}))},s=/^(?:find|findNext|findPrev|newlineAndIndent)$/,c=function(e,t){if(!1===s.test(t))return!1;const n=o(e);return"find"===t?(i(e),!0):(0!==n.length&&h(e,"findPrev"===t?-1:1),!0)},l=function(e){return e.state.search||(e.state.search=new a(e))},u=function(e){return"string"==typeof e&&e===e.toLowerCase()},d=function(e,t,n){return e.getSearchCursor(t,n,{caseFold:u(t),multiline:!1})},f=/[.*+\-?^${}()|[\]\\]/g;let g;const p=function(e){if(void 0===g&&(g=null,Intl.NumberFormat instanceof Function)){const e=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});e.resolvedOptions instanceof Function&&e.resolvedOptions().hasOwnProperty("notation")&&(g=e)}return e>1e4&&g instanceof Object?g.format(e):e.toLocaleString()},y=function(e){const t=l(e),n=t.lines,r=e.getCursor().line;let o=0,i=n.length,a=-1;for(;o<i;){a=o+i>>>1;const e=n[a];if(r===e)break;r<e?i=a:o=a+1}let s="";-1!==a&&(s=p(a+1),n[a]!==r&&(s="~"+s),s+=" / ");const c=n.length;s+=p(c);const u=t.widget.querySelector(".cm-search-widget-count");u.textContent=s,u.title=c.toLocaleString()},h=function(t,n,r){t.operation((function(){const o=l(t);if(!o.query)return;let i=d(t,o.query,n<=0?t.getCursor("from"):t.getCursor("to"));const a=n<0;if(!i.find(a)&&(i=d(t,o.query,a?e.Pos(t.lastLine()):e.Pos(t.firstLine(),0)),!i.find(a)))return;t.setSelection(i.from(),i.to());const{clientHeight:s}=t.getScrollInfo();t.scrollIntoView({from:i.from(),to:i.to()},s>>>1),r&&r(i.from(),i.to())}))},m=function(e,t){const n=l(e);null!==n.queryTimer&&(clearTimeout(n.queryTimer),n.queryTimer=null);const r=o(e);r!==n.queryText&&(n.queryText=r,""===n.queryText?function(e,t){e.operation((function(){const t=l(e);t.query&&(t.query=t.queryText=null),t.lines=[],void 0!==t.overlay&&(e.removeOverlay(t.overlay),t.overlay=void 0),t.annotate&&(t.annotate.clear(),t.annotate=void 0),t.widget.removeAttribute("data-query")}))}(e):e.operation((function(){(function(e,t){var n,r;t.query=function(e){let t="i",n=e.match(/^\/(.+)\/([iu]*)$/);if(null!==n)try{const r=new RegExp(n[1],n[2]);e=r.source,t=r.flags}catch(e){n=null}var r;return null===n&&(/[A-Z]/.test(e)&&(t=""),e=(r=e,r.replace(/\\[nrt\\]/g,(e=>"\\n"===e?"\n":"\\r"===e?"\r":"\\t"===e?"\t":"\\\\"===e?"\\":e))).replace(f,"\\$&")),("string"==typeof e?""===e:e.test(""))&&(e="x^"),new RegExp(e,"gm"+t)}(t.queryText),void 0!==t.overlay&&e.removeOverlay(t.overlay,u(t.query)),t.overlay=(n=t.query,r=u(t.query),"string"==typeof n?n=new RegExp(n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r?"gi":"g"):n.global||(n=new RegExp(n.source,n.ignoreCase?"gi":"g")),{token:function(e){n.lastIndex=e.pos;const t=n.exec(e.string);if(t&&t.index===e.pos)return e.pos+=t[0].length||1,"searching";t?e.pos=t.index:e.skipToEnd()}}),e.addOverlay(t.overlay),(t.dirty||self.searchThread.needHaystack())&&(self.searchThread.setHaystack(e.getValue()),t.dirty=!1),self.searchThread.search(t.query).then((n=>{if(!1===Array.isArray(n))return;t.lines=n;const r=n.length;if(y(e),void 0!==t.annotate&&(t.annotate.clear(),t.annotate=void 0),0===r)return;t.annotate=e.annotateScrollbar("CodeMirror-search-match");const o=[];let i=-1,a=-1;for(const e of n)-1!==i?e!==a?(o.push({from:{line:i,ch:0},to:{line:a,ch:0}}),i=-1):a=e+1:(i=e,a=e+1);-1!==i&&o.push({from:{line:i,ch:0},to:{line:a,ch:0}}),t.annotate.update(o)})),t.widget.setAttribute("data-query",t.queryText);const o=t.widget.querySelector(".cm-search-widget-input input");o.selectionStart=o.selectionStart})(e,n),h(e,t)})))};{const e='<div class="cm-search-widget-template" style="display:none;"><div class="cm-search-widget"><span class="cm-search-widget-input"><span class="fa-icon fa-icon-ro">search</span>&ensp;<input type="search" spellcheck="false">&emsp;<span class="cm-search-widget-up cm-search-widget-button fa-icon">angle-up</span>&nbsp;<span class="cm-search-widget-down cm-search-widget-button fa-icon fa-icon-vflipped">angle-up</span>&emsp;<span class="cm-search-widget-count"></span></span><a class="fa-icon sourceURL" href>external-link</a></div></div>',t=(new DOMParser).parseFromString(e,"text/html"),n=document.adoptNode(t.body.firstElementChild);document.body.appendChild(n)}e.commands.find=function(e){let t=e.getSelection()||void 0;if(!t){const n=e.findWordAt(e.getCursor());t=e.getRange(n.anchor,n.head),/^\W|\W$/.test(t)&&(t=void 0),e.setCursor(n.anchor)}i(e,t),m(e,1)},e.commands.findNext=function(e){if(l(e).query)return h(e,1)},e.commands.findPrev=function(e){if(l(e).query)return h(e,-1)},e.defineInitHook((function(e){l(e)}))}(self.CodeMirror);