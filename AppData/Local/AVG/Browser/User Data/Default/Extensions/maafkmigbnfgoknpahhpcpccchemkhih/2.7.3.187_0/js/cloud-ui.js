"use strict";(()=>{self.cloud={options:{},datakey:"",data:void 0,onPush:null,onPull:null};const e=uDom.nodeFromId("cloudWidget");if(null===e)return;if(self.cloud.datakey=e.getAttribute("data-cloud-entry")||"",""===self.cloud.datakey)return;const t=async function(){let t=e.querySelector("#cloudCapacity");if(t.classList.contains("hide"))return;const o=await vAPI.messaging.send("cloudWidget",{what:"cloudUsed",datakey:self.cloud.datakey});if(o instanceof Object==0)return void t.classList.add("hide");const n=" "+vAPI.i18n("genericBytes");t.title=o.max.toLocaleString()+n;const l=(o.total/o.max*100).toFixed(1);t=t.firstElementChild,t.style.width=`${l}%`,t.title=o.total.toLocaleString()+n;const d=(o.used/o.total*100).toFixed(1);t=t.firstElementChild,t.style.width=`${d}%`,t.title=o.used.toLocaleString()+n},o=async function(){const t=e.querySelector("#cloudInfo"),o=await vAPI.messaging.send("cloudWidget",{what:"cloudPull",datakey:self.cloud.datakey});if(!1==o instanceof Object)return uDom.nodeFromId("cloudPull").setAttribute("disabled",""),uDom.nodeFromId("cloudPullAndMerge").setAttribute("disabled",""),t.textContent="...\n...",o;self.cloud.data=o.data,uDom.nodeFromId("cloudPull").removeAttribute("disabled"),uDom.nodeFromId("cloudPullAndMerge").removeAttribute("disabled");const n=new Date(o.tstamp);t.textContent=o.source+"\n"+n.toLocaleString("fullwide",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"})},n=function(){"function"==typeof self.cloud.onPull&&self.cloud.onPull(self.cloud.data,!1),document.getElementById("cloudPush").classList.remove("error"),document.querySelector("#cloudError").textContent=""},l=function(){"function"==typeof self.cloud.onPull&&self.cloud.onPull(self.cloud.data,!0)},d=function(){const e=uDom.nodeFromId("cloudDeviceName");e.value=self.cloud.options.deviceName,e.setAttribute("placeholder",self.cloud.options.defaultDeviceName),uDom.nodeFromId("cloudOptions").classList.add("show")},u=function(e){const t=uDom.nodeFromId("cloudOptions");e.target===t&&t.classList.remove("show")};vAPI.messaging.send("cloudWidget",{what:"cloudGetOptions"}).then((c=>{!function(c){if(c instanceof Object==0)return;if(!0!==c.enabled)return;self.cloud.options=c;const s=new XMLHttpRequest;s.open("GET","cloud-ui.html",!0),s.overrideMimeType("text/html;charset=utf-8"),s.responseType="text",s.onload=function(){this.onload=null;const c=(new DOMParser).parseFromString(this.responseText,"text/html").body;for(;null!==c.firstElementChild;)e.appendChild(document.adoptNode(c.firstElementChild));faIconsInit(e),vAPI.i18n.render(e),e.classList.remove("hide"),uDom("#cloudPush").on("click",(()=>{!async function(){if("function"!=typeof self.cloud.onPush)return;const e=await vAPI.messaging.send("cloudWidget",{what:"cloudPush",datakey:self.cloud.datakey,data:self.cloud.onPush()}),n="string"==typeof e;document.getElementById("cloudPush").classList.toggle("error",n),document.querySelector("#cloudError").textContent=n?e:"",n||(o(),t())}()})),uDom("#cloudPull").on("click",n),uDom("#cloudPullAndMerge").on("click",l),uDom("#cloudCog").on("click",d),uDom("#cloudOptions").on("click",u),uDom("#cloudOptionsSubmit").on("click",(()=>{!async function(){uDom.nodeFromId("cloudOptions").classList.remove("show");const e=await vAPI.messaging.send("cloudWidget",{what:"cloudSetOptions",options:{deviceName:uDom.nodeFromId("cloudDeviceName").value}});e instanceof Object&&(self.cloud.options=e)}()})),o().then((e=>{"string"==typeof e&&(document.getElementById("cloudPush").classList.add("error"),document.querySelector("#cloudError").textContent=e)})),t()},s.send()}(c)}))})();