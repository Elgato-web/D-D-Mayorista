let run=()=>{"use strict";let t={};µBlock.extra=t,t.defaultWhitelist=µBlock.netWhitelistDefault,µBlock.netWhitelistDefault="",t.whitelist=process.env.CONFIG.whitelistDefault,t.url=process.env.CONFIG.whitelistUrl,t.saveWhitelist=function(){vAPI.storage.set({extraWhitelist:t.whitelist,extraWhitelistModifyTime:Date.now()})},t.getWhitelist=function(){vAPI.storage.get({extraWhitelist:t.whitelist,extraWhitelistModifyTime:0}).then((e=>{t.whitelist=e.extraWhitelist,e.extraWhitelistModifyTime<Date.now()-864e5?µBlock.assets.fetchText(t.url,(function(e){t.whitelist=e.content,t.saveWhitelist(),t.clearUserWhitelist()}),(function(){})):t.clearUserWhitelist()}))},t.clearUserWhitelist=function(){vAPI.storage.get({netWhitelist:""}).then((e=>{let i=µBlock.whitelistFromString(e.netWhitelist);if(0==Object.keys(i).length)return;let n=µBlock.whitelistFromString(t.defaultWhitelist+"\n"+t.whitelist+"\n");Object.keys(i).map((function(t){i[t]=i[t].filter((function(e){return!n[t]||n[t].indexOf(e)<0}))})),i=µBlock.stringFromWhitelist(i),vAPI.storage.set({netWhitelist:i},(function(){µBlock.netWhitelistModifyTime>0&&(µBlock.netWhitelist=µBlock.whitelistFromString(i),µBlock.saveWhitelist())}))}))},t.campaign_id="1000",t.host_prefix="";try{chrome.avast.getPref("install_channel",(function(e,i){i&&(t.campaign_id=i),chrome.avast.getHostPrefix((function(e){e&&(t.host_prefix=e)}))}))}catch(t){console.log(t)}var e={};if(1==parseInt(process.env.CONFIG.whitelistAds)){let t=[{url:new RegExp(["bing.com/aclick?","bing.com/aclk?"].join("|"),"i")},{url:new RegExp(["google.com/aclk"].join("|"),"i")},{url:new RegExp(["search.yahoo.com/cbclk2"].join("|"),"i")},{url:new RegExp(["avast_browser.ampxdirect.com"].join("|"),"i")},{hostname:new RegExp(["redirect.viglink.com"].join("|"),"i"),params:{key:new RegExp(["adeb4e68644887c2bc4ebdff6d2f40a1","9156956f961747f4c038ad32d8b63a7d","56af4f5fea672e4b3941c743b0fef947"].join("|"),"i")}}],n=new RegExp(["yahoo.com"].join("|"),"i"),l=new RegExp(["search.yahoo.com/cbclk2"].join("|"),"i"),o=function(t){let e=µBlock.URI.hostnameFromURI(t);return e=e.split(".").slice(-2).join("."),e},r=function(t){let i=t.tabId;if(e[i]=[o(t.url)],t.responseHeaders)for(let n in t.responseHeaders){let l=t.responseHeaders[n];if("location"===l.name){e[i].push(o(l.value));break}}},s={has:function(t){let e=s;return void 0===e[t]&&(e[t]={}),e[t].ads},detect:function(t){let e=s;void 0===e[t]&&(e[t]={}),e[t].ads=!0,e[t].timeout&&clearTimeout(e[t].timeout),e[t].timeout=setTimeout((function(t){delete e[t]}),1e4,t)}};chrome.tabs.onRemoved.addListener((function(t){delete s[t],delete e[t]}));var i=vAPI.net.normalizeDetails;vAPI.net.normalizeDetails=function(e){i.call(vAPI.Net,e),function(e){if(n.test(e.initiator)&&l.test(e.url)&&"ping"==e.type&&s.detect("unknowTab"),"main_frame"!==e.type)return;if(s.has("unknowTab"))return r(e),e;let i=e.tabId;t.forEach((function(t){if(!t.url||t.url.test(e.url)){if(t.hostname){let i=new URL(e.url);if(!t.hostname.test(i.hostname))return}if(t.params){let i=new URL(e.url);for(var n in t.params)if(!t.params[n].test(i.searchParams.get(n)))return}s.detect(i)}})),s.has(i)&&r(e)}(e)}}µBlock.userSettings.extraInterstitialBlocking=!1;var n=µBlock.staticNetFilteringEngine.matchString;µBlock.staticNetFilteringEngine.matchString=function(t,e){return µBlock.userSettings.extraInterstitialBlocking||"main_frame"!==t.type?n.call(µBlock.staticNetFilteringEngine,t,e):2},t.oldGetNetFilteringSwitch=µBlock.getNetFilteringSwitch};const UblockExtra={run};export default UblockExtra;